import{a as si}from"./chunk-YJPUX3FE.js";import{A as Ct,B as Wt,C as Zt,D as Jt,E as Xt,F as ei,G as ii,H as ni,I as oi,J as ri,K as Ce,L as ai,M as ci,b as gt,c as Lt,d as Ae,f as Re,g as Bt,h as Ut,i as Ht,j as _t,k as Ve,l as ft,m as ue,n as De,o as qt,p as ze,q as he,r as Le,s as Ne,t as Be,u as Ue,v as Gt,w as $t,x as Kt,y as Qt,z as Yt}from"./chunk-V6K56X2N.js";import"./chunk-WXI33M2S.js";import{b as Nt,c as de,h as pe,i as He,j as ti,l as ge,p as _e,t as fe}from"./chunk-TYDQPGPQ.js";import{$a as re,Aa as B,B as Tt,Ca as pt,Da as v,Db as Vt,Ea as U,Eb as Dt,Fa as V,G as It,Ga as D,Ha as a,Hb as xe,Ia as c,Ja as x,K as we,L as ve,M as j,Ma as k,O as ct,Pa as C,Q as Ft,Qa as s,R as I,S as y,T as Me,U as J,Ua as H,Va as q,W as te,Wa as G,X as p,Xa as Y,Y as u,Ya as S,Z as lt,Za as X,_ as bt,_a as $,a as R,ab as se,ac as zt,b as ee,ba as Ot,bb as ae,bc as Pe,ca as w,cb as Fe,db as ie,ea as mt,eb as ut,fb as M,g as rt,gb as P,hb as W,i as st,ia as Ee,ib as Pt,ja as N,jb as At,ka as l,la as f,mb as be,n as at,pc as me,qa as Te,ra as dt,sb as ce,t as Mt,tb as Se,ua as Ie,ub as ht,vb as Oe,wa as _,wb as Rt,x as Et,xa as Q,ya as h,yb as F,za as oe,zb as le}from"./chunk-BQNWQ6CD.js";var mi=(()=>{let o=class o{constructor(e){this.fileService=e}transform(e){return this.fileService.getFilePreviewBySrc(e)}};o.\u0275fac=function(i){return new(i||o)(f(pe,16))},o.\u0275pipe=J({name:"filePreview",type:o,pure:!0});let n=o;return n})(),di=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({});let n=o;return n})();function Wi(n,o){if(n&1&&x(0,"img",1),n&2){let t=s(2);h("src",t.url,N)("alt","\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435")}}function Zi(n,o){if(n&1&&(a(0,"video",2),x(1,"source",3),c()),n&2){let t=s(2);l(),h("src",t.url,N)("type",t.mimeType)}}function Ji(n,o){if(n&1&&(a(0,"a",4),S(1),c()),n&2){let t=s(2);h("target","_blank")("href",t.url,N)("download",t.name),l(),$(" ",t.name," ")}}function Xi(n,o){if(n&1&&_(0,Wi,1,2)(1,Zi,2,2)(2,Ji,2,4),n&2){let t,e=s(),i=s();v(0,(t=e.category)===i.eCategory.IMAGE?0:t===i.eCategory.VIDEO?1:2)}}function en(n,o){n&1&&(a(0,"span",5),S(1,"\u041D\u0435\u0442 \u0444\u0430\u0439\u043B\u0430"),c())}function tn(n,o){n&1&&_(0,Xi,3,1)(1,en,2,0),n&2&&v(0,o?0:1)}function nn(n,o){n&1&&x(0,"app-loader")}var qe=(()=>{let o=class o{constructor(){this.fileSrc="",this.height=100,this.eCategory=Nt}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=I({type:o,selectors:[["app-file-preview"]],inputs:{fileSrc:"fileSrc",height:"height"},decls:5,vars:7,consts:[[1,"preview"],[1,"preview__img",3,"src","alt"],["controls","",1,"preview__video"],[3,"src","type"],["onclick","event.stopPropagation()",1,"preview__doc","link","font-basic-14",3,"target","href","download"],[1,"font-basic-14"]],template:function(i,r){if(i&1&&(a(0,"div",0),_(1,tn,2,1),M(2,"filePreview"),M(3,"async"),_(4,nn,1,0),c()),i&2){let m;oe("--height",r.height+"px"),l(),v(1,(m=P(3,5,P(2,3,r.fileSrc)))?1:4,m)}},dependencies:[he,Oe,mi],styles:[".preview[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.preview__img[_ngcontent-%COMP%], .preview__video[_ngcontent-%COMP%]{max-height:var(--height);min-height:var(--height);max-width:100%;object-fit:contain}.preview__video[_ngcontent-%COMP%]{aspect-ratio:16/9}"]});let n=o;return n})();function on(n,o){if(n&1){let t=k();a(0,"span",3),C("click",function(i){p(t);let r=s().index,m=s();return u(m.handleClick(i,r))}),a(1,"div"),lt(),a(2,"svg",4),x(3,"path"),c()(),bt(),x(4,"span",5),c()}if(n&2){let t=s().$implicit,e=s();oe("color",t.name===e.selected?e.color:null),B("emoji-mart-anchor-selected",t.name===e.selected),Q("title",e.i18n.categories[t.id]),l(3),Q("d",e.icons[t.id]),l(),oe("background-color",e.color)}}function rn(n,o){if(n&1&&_(0,on,5,8,"span",2),n&2){let t=o.$implicit;h("ngIf",t.anchor!==!1)}}var sn=["container"],an=["label"];function cn(n,o){if(n&1){let t=k();a(0,"ngx-emoji",9),C("emojiOverOutsideAngular",function(i){p(t);let r=s(3);return u(r.emojiOverOutsideAngular.emit(i))})("emojiLeaveOutsideAngular",function(i){p(t);let r=s(3);return u(r.emojiLeaveOutsideAngular.emit(i))})("emojiClickOutsideAngular",function(i){p(t);let r=s(3);return u(r.emojiClickOutsideAngular.emit(i))}),c()}if(n&2){let t=o.$implicit,e=s(3);h("emoji",t)("size",e.emojiSize)("skin",e.emojiSkin)("isNative",e.emojiIsNative)("set",e.emojiSet)("sheetSize",e.emojiSheetSize)("forceSize",e.emojiForceSize)("tooltip",e.emojiTooltip)("backgroundImageFn",e.emojiBackgroundImageFn)("imageUrlFn",e.emojiImageUrlFn)("hideObsolete",e.hideObsolete)("useButton",e.emojiUseButton)}}function ln(n,o){if(n&1&&(a(0,"div"),_(1,cn,1,12,"ngx-emoji",8),c()),n&2){let t=o.ngIf,e=s(2);l(),h("ngForOf",t)("ngForTrackBy",e.trackById)}}function mn(n,o){if(n&1&&(a(0,"div"),_(1,ln,2,2,"div",7),M(2,"async"),c()),n&2){let t=s();l(),h("ngIf",P(2,1,t.filteredEmojis$))}}function dn(n,o){if(n&1&&(a(0,"div")(1,"div"),x(2,"ngx-emoji",10),c(),a(3,"div",11),S(4),c()()),n&2){let t=s();l(2),h("emoji",t.notFoundEmoji)("size",38)("skin",t.emojiSkin)("isNative",t.emojiIsNative)("set",t.emojiSet)("sheetSize",t.emojiSheetSize)("forceSize",t.emojiForceSize)("tooltip",t.emojiTooltip)("backgroundImageFn",t.emojiBackgroundImageFn)("useButton",t.emojiUseButton),l(2),$(" ",t.i18n.notfound," ")}}function pn(n,o){if(n&1){let t=k();a(0,"ngx-emoji",9),C("emojiOverOutsideAngular",function(i){p(t);let r=s(2);return u(r.emojiOverOutsideAngular.emit(i))})("emojiLeaveOutsideAngular",function(i){p(t);let r=s(2);return u(r.emojiLeaveOutsideAngular.emit(i))})("emojiClickOutsideAngular",function(i){p(t);let r=s(2);return u(r.emojiClickOutsideAngular.emit(i))}),c()}if(n&2){let t=o.$implicit,e=s(2);h("emoji",t)("size",e.emojiSize)("skin",e.emojiSkin)("isNative",e.emojiIsNative)("set",e.emojiSet)("sheetSize",e.emojiSheetSize)("forceSize",e.emojiForceSize)("tooltip",e.emojiTooltip)("backgroundImageFn",e.emojiBackgroundImageFn)("imageUrlFn",e.emojiImageUrlFn)("hideObsolete",e.hideObsolete)("useButton",e.emojiUseButton)}}function un(n,o){if(n&1&&_(0,pn,1,12,"ngx-emoji",8),n&2){let t=s();h("ngForOf",t.emojisToDisplay)("ngForTrackBy",t.trackById)}}function hn(n,o){if(n&1){let t=k();a(0,"span",2)(1,"span",3),C("click",function(){let i=p(t).$implicit,r=s();return u(r.handleClick(i))})("keyup.enter",function(){let i=p(t).$implicit,r=s();return u(r.handleClick(i))})("keyup.space",function(){let i=p(t).$implicit,r=s();return u(r.handleClick(i))}),c()()}if(n&2){let t=o.$implicit,e=s();B("selected",t===e.skin),l(),pt("emoji-mart-skin emoji-mart-skin-tone-",t,""),h("tabIndex",e.tabIndex(t)),Q("aria-hidden",!e.isVisible(t))("aria-pressed",e.pressed(t))("aria-haspopup",!!e.isSelected(t))("aria-expanded",e.expanded(t))("aria-label",e.i18n.skintones[t])("title",e.i18n.skintones[t])}}function gn(n,o){if(n&1&&(a(0,"span",11),S(1),c()),n&2){let t=o.$implicit;l(),$(" :",t,": ")}}function _n(n,o){if(n&1&&(a(0,"span",15),S(1),c()),n&2){let t=o.$implicit;l(),$(" ",t," ")}}function fn(n,o){if(n&1&&(a(0,"div",8)(1,"div",2),x(2,"ngx-emoji",9),c(),a(3,"div",4)(4,"div",10),S(5),c(),a(6,"div",11),_(7,gn,2,1,"span",12),c(),a(8,"div",13),_(9,_n,2,1,"span",14),c()()()),n&2){let t=s();l(2),h("emoji",t.emoji)("size",38)("isNative",t.emojiIsNative)("skin",t.emojiSkin)("size",t.emojiSize)("set",t.emojiSet)("sheetSize",t.emojiSheetSize)("backgroundImageFn",t.emojiBackgroundImageFn)("imageUrlFn",t.emojiImageUrlFn),l(3),X(t.emojiData.name),l(2),h("ngForOf",t.emojiData.shortNames),l(2),h("ngForOf",t.listedEmoticons)}}function Cn(n,o){if(n&1&&x(0,"ngx-emoji",16),n&2){let t=s();h("isNative",t.emojiIsNative)("skin",t.emojiSkin)("set",t.emojiSet)("emoji",t.idleEmoji)("backgroundImageFn",t.emojiBackgroundImageFn)("size",38)("imageUrlFn",t.emojiImageUrlFn)}}var vn=["inputRef"],Sn=["scrollRef"];function xn(n,o){if(n&1){let t=k();a(0,"emoji-search",8),C("searchResults",function(i){p(t);let r=s();return u(r.handleSearch(i))})("enterKeyOutsideAngular",function(i){p(t);let r=s();return u(r.handleEnterKey(i))}),c()}if(n&2){let t=s();h("i18n",t.i18n)("include",t.include)("exclude",t.exclude)("custom",t.custom)("autoFocus",t.autoFocus)("icons",t.searchIcons)("emojisToShowFilter",t.emojisToShowFilter)}}function jn(n,o){if(n&1){let t=k();a(0,"emoji-category",9),C("emojiOverOutsideAngular",function(i){p(t);let r=s();return u(r.handleEmojiOver(i))})("emojiLeaveOutsideAngular",function(){p(t);let i=s();return u(i.handleEmojiLeave())})("emojiClickOutsideAngular",function(i){p(t);let r=s();return u(r.handleEmojiClick(i))}),c()}if(n&2){let t=o.$implicit,e=s();h("id",t.id)("name",t.name)("emojis",t.emojis)("perLine",e.perLine)("totalFrequentLines",e.totalFrequentLines)("hasStickyPosition",e.isNative)("i18n",e.i18n)("hideObsolete",e.hideObsolete)("notFoundEmoji",e.notFoundEmoji)("custom",t.id===e.RECENT_CATEGORY.id?e.CUSTOM_CATEGORY.emojis:void 0)("recent",t.id===e.RECENT_CATEGORY.id?e.recent:void 0)("virtualize",e.virtualize)("virtualizeOffset",e.virtualizeOffset)("emojiIsNative",e.isNative)("emojiSkin",e.skin)("emojiSize",e.emojiSize)("emojiSet",e.set)("emojiSheetSize",e.sheetSize)("emojiForceSize",e.isNative)("emojiTooltip",e.emojiTooltip)("emojiBackgroundImageFn",e.backgroundImageFn)("emojiImageUrlFn",e.imageUrlFn)("emojiUseButton",e.useButton)}}function yn(n,o){if(n&1){let t=k();a(0,"div",2)(1,"emoji-preview",10),C("skinChange",function(i){p(t);let r=s();return u(r.handleSkinChange(i))}),c()()}if(n&2){let t=s();l(),h("emoji",t.previewEmoji)("idleEmoji",t.emoji)("emojiIsNative",t.isNative)("emojiSize",38)("emojiSkin",t.skin)("emojiSet",t.set)("i18n",t.i18n)("emojiSheetSize",t.sheetSize)("emojiBackgroundImageFn",t.backgroundImageFn)("emojiImageUrlFn",t.imageUrlFn),Q("title",t.title)}}var Si=(()=>{class n{categories=[];color;selected;i18n;icons={};anchorClick=new w;trackByFn(t,e){return e.id}handleClick(t,e){this.anchorClick.emit({category:this.categories[e],index:e})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["emoji-mart-anchors"]],inputs:{categories:"categories",color:"color",selected:"selected",i18n:"i18n",icons:"icons"},outputs:{anchorClick:"anchorClick"},standalone:!0,features:[ie],decls:2,vars:2,consts:[[1,"emoji-mart-anchors"],["ngFor","",3,"ngForOf","ngForTrackBy"],["class","emoji-mart-anchor",3,"emoji-mart-anchor-selected","color","click",4,"ngIf"],[1,"emoji-mart-anchor",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","width","24","height","24"],[1,"emoji-mart-anchor-bar"]],template:function(e,i){e&1&&(a(0,"div",0),_(1,rn,1,1,"ng-template",1),c()),e&2&&(l(),h("ngForOf",i.categories)("ngForTrackBy",i.trackByFn))},dependencies:[F,ce,Se],encapsulation:2,changeDetection:0})}return n})(),xi=(()=>{class n{platformId;NAMESPACE="emoji-mart";frequently=null;defaults={};initialized=!1;DEFAULTS=["+1","grinning","kissing_heart","heart_eyes","laughing","stuck_out_tongue_winking_eye","sweat_smile","joy","scream","disappointed","unamused","weary","sob","sunglasses","heart","poop"];constructor(t){this.platformId=t}init(){this.frequently=JSON.parse(le(this.platformId)&&localStorage.getItem(`${this.NAMESPACE}.frequently`)||"null"),this.initialized=!0}add(t){this.initialized||this.init(),this.frequently||(this.frequently=this.defaults),this.frequently[t.id]||(this.frequently[t.id]=0),this.frequently[t.id]+=1,le(this.platformId)&&(localStorage.setItem(`${this.NAMESPACE}.last`,t.id),localStorage.setItem(`${this.NAMESPACE}.frequently`,JSON.stringify(this.frequently)))}get(t,e){if(this.initialized||this.init(),this.frequently===null){this.defaults={};let A=[];for(let T=0;T<t;T++)this.defaults[this.DEFAULTS[T]]=t-T,A.push(this.DEFAULTS[T]);return A}let i=t*e,d=Object.keys(this.frequently).sort((A,T)=>this.frequently[A]-this.frequently[T]).reverse().slice(0,i),g=le(this.platformId)&&localStorage.getItem(`${this.NAMESPACE}.last`);return g&&!d.includes(g)&&(d.pop(),d.push(g)),d}static \u0275fac=function(e){return new(e||n)(ct(mt))};static \u0275prov=ve({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),St=(()=>{class n{ref;emojiService;frequently;emojis=null;hasStickyPosition=!0;name="";perLine=9;totalFrequentLines=4;recent=[];custom=[];i18n;id;hideObsolete=!0;notFoundEmoji;virtualize=!1;virtualizeOffset=0;emojiIsNative;emojiSkin;emojiSize;emojiSet;emojiSheetSize;emojiForceSize;emojiTooltip;emojiBackgroundImageFn;emojiImageUrlFn;emojiUseButton;emojiOverOutsideAngular=new w;emojiLeaveOutsideAngular=new w;emojiClickOutsideAngular=new w;container;label;containerStyles={};emojisToDisplay=[];filteredEmojisSubject=new st;filteredEmojis$=this.filteredEmojisSubject.asObservable();labelStyles={};labelSpanStyles={};margin=0;minMargin=0;maxMargin=0;top=0;rows=0;constructor(t,e,i){this.ref=t,this.emojiService=e,this.frequently=i}ngOnInit(){this.updateRecentEmojis(),this.emojisToDisplay=this.filterEmojis(),this.noEmojiToDisplay&&(this.containerStyles={display:"none"}),this.hasStickyPosition||(this.labelStyles={height:28})}ngOnChanges(t){t.emojis?.currentValue?.length!==t.emojis?.previousValue?.length&&(this.emojisToDisplay=this.filterEmojis(),this.ngAfterViewInit())}ngAfterViewInit(){if(!this.virtualize)return;let{width:t}=this.container.nativeElement.getBoundingClientRect(),e=Math.floor(t/(this.emojiSize+12));this.rows=Math.ceil(this.emojisToDisplay.length/e),this.containerStyles=ee(R({},this.containerStyles),{minHeight:`${this.rows*(this.emojiSize+12)+28}px`}),this.ref.detectChanges(),this.handleScroll(this.container.nativeElement.parentNode.parentNode.scrollTop)}get noEmojiToDisplay(){return this.emojisToDisplay.length===0}memoizeSize(){let t=this.container.nativeElement.parentNode.parentNode,{top:e,height:i}=this.container.nativeElement.getBoundingClientRect(),r=t.getBoundingClientRect().top,m=this.label.nativeElement.getBoundingClientRect().height;this.top=e-r+t.scrollTop,i===0?this.maxMargin=0:this.maxMargin=i-m}handleScroll(t){let e=t-this.top;if(e=e<this.minMargin?this.minMargin:e,e=e>this.maxMargin?this.maxMargin:e,this.virtualize){let{top:i,height:r}=this.container.nativeElement.getBoundingClientRect(),m=this.container.nativeElement.parentNode.parentNode.clientHeight;m+(m+this.virtualizeOffset)>=i&&-r-(m+this.virtualizeOffset)<=i?this.filteredEmojisSubject.next(this.emojisToDisplay):this.filteredEmojisSubject.next([])}return e===this.margin?(this.ref.detectChanges(),!1):(this.hasStickyPosition||(this.label.nativeElement.style.top=`${e}px`),this.margin=e,this.ref.detectChanges(),!0)}updateRecentEmojis(){if(this.name!=="Recent")return;let t=this.recent||this.frequently.get(this.perLine,this.totalFrequentLines);(!t||!t.length)&&(t=this.frequently.get(this.perLine,this.totalFrequentLines)),t.length&&(this.emojis=t.map(e=>{let i=this.custom.filter(r=>r.id===e)[0];return i||e}).filter(e=>!!this.emojiService.getData(e)))}updateDisplay(t){this.containerStyles.display=t,this.updateRecentEmojis(),this.ref.detectChanges()}trackById(t,e){return e}filterEmojis(){let t=[];for(let e of this.emojis||[]){if(!e)continue;let i=this.emojiService.getData(e);!i||i.obsoletedBy&&this.hideObsolete||!i.unified&&!i.custom||t.push(e)}return t}static \u0275fac=function(e){return new(e||n)(f(be),f(Ve),f(xi))};static \u0275cmp=I({type:n,selectors:[["emoji-category"]],viewQuery:function(e,i){if(e&1&&(H(sn,7),H(an,7)),e&2){let r;q(r=G())&&(i.container=r.first),q(r=G())&&(i.label=r.first)}},inputs:{emojis:"emojis",hasStickyPosition:"hasStickyPosition",name:"name",perLine:"perLine",totalFrequentLines:"totalFrequentLines",recent:"recent",custom:"custom",i18n:"i18n",id:"id",hideObsolete:"hideObsolete",notFoundEmoji:"notFoundEmoji",virtualize:"virtualize",virtualizeOffset:"virtualizeOffset",emojiIsNative:"emojiIsNative",emojiSkin:"emojiSkin",emojiSize:"emojiSize",emojiSet:"emojiSet",emojiSheetSize:"emojiSheetSize",emojiForceSize:"emojiForceSize",emojiTooltip:"emojiTooltip",emojiBackgroundImageFn:"emojiBackgroundImageFn",emojiImageUrlFn:"emojiImageUrlFn",emojiUseButton:"emojiUseButton"},outputs:{emojiOverOutsideAngular:"emojiOverOutsideAngular",emojiLeaveOutsideAngular:"emojiLeaveOutsideAngular",emojiClickOutsideAngular:"emojiClickOutsideAngular"},standalone:!0,features:[te,ie],decls:10,vars:11,consts:[["container",""],["label",""],["normalRenderTemplate",""],[1,"emoji-mart-category",3,"ngStyle"],[1,"emoji-mart-category-label",3,"ngStyle"],["aria-hidden","true",3,"ngStyle"],[4,"ngIf","ngIfElse"],[4,"ngIf"],[3,"emoji","size","skin","isNative","set","sheetSize","forceSize","tooltip","backgroundImageFn","imageUrlFn","hideObsolete","useButton","emojiOverOutsideAngular","emojiLeaveOutsideAngular","emojiClickOutsideAngular",4,"ngFor","ngForOf","ngForTrackBy"],[3,"emojiOverOutsideAngular","emojiLeaveOutsideAngular","emojiClickOutsideAngular","emoji","size","skin","isNative","set","sheetSize","forceSize","tooltip","backgroundImageFn","imageUrlFn","hideObsolete","useButton"],[3,"emoji","size","skin","isNative","set","sheetSize","forceSize","tooltip","backgroundImageFn","useButton"],[1,"emoji-mart-no-results-label"]],template:function(e,i){if(e&1&&(a(0,"section",3,0)(2,"div",4)(3,"span",5,1),S(5),c()(),_(6,mn,3,3,"div",6)(7,dn,5,11,"div",7),c(),_(8,un,1,2,"ng-template",null,2,At)),e&2){let r=Y(9);B("emoji-mart-no-results",i.noEmojiToDisplay),h("ngStyle",i.containerStyles),Q("aria-label",i.i18n.categories[i.id]),l(2),h("ngStyle",i.labelStyles),Q("data-name",i.name),l(),h("ngStyle",i.labelSpanStyles),l(2),$(" ",i.i18n.categories[i.id]," "),l(),h("ngIf",i.virtualize)("ngIfElse",r),l(),h("ngIf",i.noEmojiToDisplay)}},dependencies:[F,ce,Se,ht,Oe,ft],encapsulation:2,changeDetection:0})}return n})();function gi(n){return n.reduce((o,t)=>(o.includes(t)||o.push(t),o),[])}function kn(n,o){let t=gi(n),e=gi(o);return t.filter(i=>e.indexOf(i)>=0)}function wn(){if(typeof document>"u")return 0;let n=document.createElement("div");n.style.width="100px",n.style.height="100px",n.style.overflow="scroll",n.style.position="absolute",n.style.top="-9999px",document.body.appendChild(n);let o=n.offsetWidth-n.clientWidth;return document.body.removeChild(n),o}var Mn=(()=>{class n{emojiService;originalPool={};index={};emojisList={};emoticonsList={};emojiSearch={};constructor(t){this.emojiService=t;for(let e of this.emojiService.emojis){let{shortNames:i,emoticons:r}=e,m=i[0];for(let d of r)this.emoticonsList[d]||(this.emoticonsList[d]=m);this.emojisList[m]=this.emojiService.getSanitizedData(m),this.originalPool[m]=e}}addCustomToPool(t,e){for(let i of t){let r=i.id||i.shortNames[0];r&&!e[r]&&(e[r]=this.emojiService.getData(i),this.emojisList[r]=this.emojiService.getSanitizedData(i))}}search(t,e,i=75,r=[],m=[],d=[]){this.addCustomToPool(d,this.originalPool);let g,A=this.originalPool;if(t.length){if(t==="-"||t==="-1")return[this.emojisList[-1]];if(t==="+"||t==="+1")return[this.emojisList["+1"]];let T=t.toLowerCase().split(/[\s|,|\-|_]+/),L=[];if(T.length>2&&(T=[T[0],T[1]]),r.length||m.length){A={};for(let b of _t||[]){let z=r&&r.length?r.indexOf(b.id)>-1:!0,O=m&&m.length?m.indexOf(b.id)>-1:!1;if(!(!z||O))for(let ye of b.emojis||[]){let ne=this.emojiService.getData(ye);A[ne?.id??""]=ne}}if(d.length){let b=r&&r.length?r.indexOf("custom")>-1:!0,z=m&&m.length?m.indexOf("custom")>-1:!1;b&&!z&&this.addCustomToPool(d,A)}}L=T.map(b=>{let z=A,O=this.index,ye=0;for(let ne=0;ne<b.length;ne++){let it=b[ne];if(ye++,O[it]||(O[it]={}),O=O[it],!O.results){let nt={};O.results=[],O.pool={};for(let K of Object.keys(z)){let Z=z[K];this.emojiSearch[K]||(this.emojiSearch[K]=this.buildSearch(Z.short_names,Z.name,Z.id,Z.keywords,Z.emoticons));let ot=this.emojiSearch[K],ke=b.substr(0,ye),kt=ot.indexOf(ke);if(kt!==-1){let wt=kt+1;ke===K&&(wt=0),O.results.push(this.emojisList[K]),O.pool[K]=Z,nt[K]=wt}}O.results.sort((K,Z)=>{let ot=nt[K.id],ke=nt[Z.id];return ot-ke})}z=O.pool}return O.results}).filter(b=>b),L.length>1?g=kn.apply(null,L):L.length?g=L[0]:g=[]}return g&&(e&&(g=g.filter(T=>T&&T.id?e(this.emojiService.names[T.id]):!1)),g&&g.length>i&&(g=g.slice(0,i))),g||null}buildSearch(t,e,i,r,m){let d=[],g=(A,T)=>{if(!A)return;let L=Array.isArray(A)?A:[A];for(let b of L){let z=T?b.split(/[-|_|\s]+/):[b];for(let O of z)O=O.toLowerCase(),d.includes(O)||d.push(O)}};return g(t,!0),g(e,!0),g(i,!0),g(r,!0),g(m,!1),d.join(",")}static \u0275fac=function(e){return new(e||n)(ct(Ve))};static \u0275prov=ve({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ji=(()=>{class n{skin;i18n;changeSkin=new w;opened=!1;skinTones=[1,2,3,4,5,6];toggleOpen(){this.opened=!this.opened}isSelected(t){return t===this.skin}isVisible(t){return this.opened||this.isSelected(t)}pressed(t){return this.opened?!!this.isSelected(t):""}tabIndex(t){return this.isVisible(t)?"0":""}expanded(t){return this.isSelected(t)?this.opened:""}handleClick(t){if(!this.opened){this.opened=!0;return}this.opened=!1,t!==this.skin&&this.changeSkin.emit(t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["emoji-skins"]],inputs:{skin:"skin",i18n:"i18n"},outputs:{changeSkin:"changeSkin"},standalone:!0,features:[ie],decls:2,vars:3,consts:[[1,"emoji-mart-skin-swatches"],["class","emoji-mart-skin-swatch",3,"selected",4,"ngFor","ngForOf"],[1,"emoji-mart-skin-swatch"],["role","button",3,"click","keyup.enter","keyup.space","tabIndex"]],template:function(e,i){e&1&&(a(0,"section",0),_(1,hn,2,12,"span",1),c()),e&2&&(B("opened",i.opened),l(),h("ngForOf",i.skinTones))},dependencies:[F,ce],encapsulation:2,changeDetection:0})}return n})(),xt=(()=>{class n{ref;emojiService;title;emoji;idleEmoji;i18n;emojiIsNative;emojiSkin;emojiSize;emojiSet;emojiSheetSize;emojiBackgroundImageFn;emojiImageUrlFn;skinChange=new w;emojiData={};listedEmoticons;constructor(t,e){this.ref=t,this.emojiService=e}ngOnChanges(){if(!this.emoji)return;this.emojiData=this.emojiService.getData(this.emoji,this.emojiSkin,this.emojiSet);let t=[],e=[];(this.emojiData.emoticons||[]).forEach(r=>{t.indexOf(r.toLowerCase())>=0||(t.push(r.toLowerCase()),e.push(r))}),this.listedEmoticons=e,this.ref?.detectChanges()}static \u0275fac=function(e){return new(e||n)(f(be),f(Ve))};static \u0275cmp=I({type:n,selectors:[["emoji-preview"]],inputs:{title:"title",emoji:"emoji",idleEmoji:"idleEmoji",i18n:"i18n",emojiIsNative:"emojiIsNative",emojiSkin:"emojiSkin",emojiSize:"emojiSize",emojiSet:"emojiSet",emojiSheetSize:"emojiSheetSize",emojiBackgroundImageFn:"emojiBackgroundImageFn",emojiImageUrlFn:"emojiImageUrlFn"},outputs:{skinChange:"skinChange"},standalone:!0,features:[te,ie],decls:9,vars:6,consts:[["class","emoji-mart-preview",4,"ngIf"],[1,"emoji-mart-preview",3,"hidden"],[1,"emoji-mart-preview-emoji"],[3,"isNative","skin","set","emoji","backgroundImageFn","size","imageUrlFn",4,"ngIf"],[1,"emoji-mart-preview-data"],[1,"emoji-mart-title-label"],[1,"emoji-mart-preview-skins"],[3,"changeSkin","skin","i18n"],[1,"emoji-mart-preview"],[3,"emoji","size","isNative","skin","set","sheetSize","backgroundImageFn","imageUrlFn"],[1,"emoji-mart-preview-name"],[1,"emoji-mart-preview-shortname"],["class","emoji-mart-preview-shortname",4,"ngFor","ngForOf"],[1,"emoji-mart-preview-emoticons"],["class","emoji-mart-preview-emoticon",4,"ngFor","ngForOf"],[1,"emoji-mart-preview-emoticon"],[3,"isNative","skin","set","emoji","backgroundImageFn","size","imageUrlFn"]],template:function(e,i){e&1&&(_(0,fn,10,12,"div",0),a(1,"div",1)(2,"div",2),_(3,Cn,1,7,"ngx-emoji",3),c(),a(4,"div",4)(5,"span",5),S(6),c()(),a(7,"div",6)(8,"emoji-skins",7),C("changeSkin",function(m){return i.skinChange.emit(m)}),c()()()),e&2&&(h("ngIf",i.emoji&&i.emojiData),l(),h("hidden",i.emoji),l(2),h("ngIf",i.idleEmoji&&i.idleEmoji.length),l(3),X(i.title),l(2),h("skin",i.emojiSkin)("i18n",i.i18n))},dependencies:[F,ce,Se,ft,ji],encapsulation:2,changeDetection:0})}return n})(),En=0,jt=(()=>{class n{ngZone;emojiSearch;maxResults=75;autoFocus=!1;i18n;include=[];exclude=[];custom=[];icons;emojisToShowFilter;searchResults=new w;enterKeyOutsideAngular=new w;inputRef;isSearching=!1;icon;query="";inputId=`emoji-mart-search-${++En}`;destroy$=new st;constructor(t,e){this.ngZone=t,this.emojiSearch=e}ngOnInit(){this.icon=this.icons.search,this.setupKeyupListener()}ngAfterViewInit(){this.autoFocus&&this.inputRef.nativeElement.focus()}ngOnDestroy(){this.destroy$.next()}clear(){this.query="",this.handleSearch(""),this.inputRef.nativeElement.focus()}handleSearch(t){t===""?(this.icon=this.icons.search,this.isSearching=!1):(this.icon=this.icons.delete,this.isSearching=!0);let e=this.emojiSearch.search(this.query,this.emojisToShowFilter,this.maxResults,this.include,this.exclude,this.custom);this.searchResults.emit(e)}handleChange(){this.handleSearch(this.query)}setupKeyupListener(){this.ngZone.runOutsideAngular(()=>Mt(this.inputRef.nativeElement,"keyup").pipe(It(this.destroy$)).subscribe(t=>{!this.query||t.key!=="Enter"||(this.enterKeyOutsideAngular.emit(t),t.preventDefault())}))}static \u0275fac=function(e){return new(e||n)(f(dt),f(Mn))};static \u0275cmp=I({type:n,selectors:[["emoji-search"]],viewQuery:function(e,i){if(e&1&&H(vn,7),e&2){let r;q(r=G())&&(i.inputRef=r.first)}},inputs:{maxResults:"maxResults",autoFocus:"autoFocus",i18n:"i18n",include:"include",exclude:"exclude",custom:"custom",icons:"icons",emojisToShowFilter:"emojisToShowFilter"},outputs:{searchResults:"searchResults",enterKeyOutsideAngular:"enterKeyOutsideAngular"},standalone:!0,features:[ie],decls:8,vars:9,consts:[["inputRef",""],[1,"emoji-mart-search"],["type","search",3,"ngModelChange","id","placeholder","autofocus","ngModel"],[1,"emoji-mart-sr-only",3,"htmlFor"],["type","button",1,"emoji-mart-search-icon",3,"click","keyup.enter","disabled"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","width","13","height","13","opacity","0.5"]],template:function(e,i){if(e&1){let r=k();a(0,"div",1)(1,"input",2,0),ae("ngModelChange",function(d){return p(r),se(i.query,d)||(i.query=d),u(d)}),C("ngModelChange",function(){return p(r),u(i.handleChange())}),c(),a(3,"label",3),S(4),c(),a(5,"button",4),C("click",function(){return p(r),u(i.clear())})("keyup.enter",function(){return p(r),u(i.clear())}),lt(),a(6,"svg",5),x(7,"path"),c()()()}e&2&&(l(),h("id",i.inputId)("placeholder",i.i18n.search)("autofocus",i.autoFocus),re("ngModel",i.query),l(2),h("htmlFor",i.inputId),l(),$(" ",i.i18n.search," "),l(),h("disabled",!i.isSearching),Q("aria-label",i.i18n.clear),l(2),Q("d",i.icon))},dependencies:[fe,ti,ge,_e],encapsulation:2})}return n})(),_i={activity:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24m10 11h-5c.3-2.5 1.3-4.8 2-6.1a10 10 0 0 1 3 6.1m-9 0V2a10 10 0 0 1 4.4 1.6A18 18 0 0 0 15 11h-2zm-2 0H9a18 18 0 0 0-2.4-7.4A10 10 0 0 1 11 2.1V11zm0 2v9a10 10 0 0 1-4.4-1.6A18 18 0 0 0 9 13h2zm4 0a18 18 0 0 0 2.4 7.4 10 10 0 0 1-4.4 1.5V13h2zM5 4.9c.7 1.3 1.7 3.6 2 6.1H2a10 10 0 0 1 3-6.1M2 13h5c-.3 2.5-1.3 4.8-2 6.1A10 10 0 0 1 2 13m17 6.1c-.7-1.3-1.7-3.6-2-6.1h5a10 10 0 0 1-3 6.1",custom:"M10 1h3v21h-3zm10.186 4l1.5 2.598L3.5 18.098 2 15.5zM2 7.598L3.5 5l18.186 10.5-1.5 2.598z",flags:"M0 0l6 24h2L2 0zm21 5h-4l-1-4H4l3 12h3l1 4h13L21 5zM6.6 3h7.8l2 8H8.6l-2-8zm8.8 10l-2.9 1.9-.4-1.9h3.3zm3.6 0l-1.5-6h2l2 8H16l3-2z",foods:"M17 5c-1.8 0-2.9.4-3.7 1 .5-1.3 1.8-3 4.7-3a1 1 0 0 0 0-2c-3 0-4.6 1.3-5.5 2.5l-.2.2c-.6-1.9-1.5-3.7-3-3.7C8.5 0 7.7.3 7 1c-2 1.5-1.7 2.9-.5 4C3.6 5.2 0 7.4 0 13c0 4.6 5 11 9 11 2 0 2.4-.5 3-1 .6.5 1 1 3 1 4 0 9-6.4 9-11 0-6-4-8-7-8M8.2 2.5c.7-.5 1-.5 1-.5.4.2 1 1.4 1.4 3-1.6-.6-2.8-1.3-3-1.8l.6-.7M15 22c-1 0-1.2-.1-1.6-.4l-.1-.2a2 2 0 0 0-2.6 0l-.1.2c-.4.3-.5.4-1.6.4-2.8 0-7-5.4-7-9 0-6 4.5-6 5-6 2 0 2.5.4 3.4 1.2l.3.3a2 2 0 0 0 2.6 0l.3-.3c1-.8 1.5-1.2 3.4-1.2.5 0 5 .1 5 6 0 3.6-4.2 9-7 9",nature:"M15.5 8a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m-7 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m10.43-8h-.02c-.97 0-2.14.79-3.02 1.5A13.88 13.88 0 0 0 12 .99c-1.28 0-2.62.13-3.87.51C7.24.8 6.07 0 5.09 0h-.02C3.35 0 .07 2.67 0 7.03c-.04 2.47.28 4.23 1.04 5 .26.27.88.69 1.3.9.19 3.17.92 5.23 2.53 6.37.9.64 2.19.95 3.2 1.1-.03.2-.07.4-.07.6 0 1.77 2.35 3 4 3s4-1.23 4-3c0-.2-.04-.4-.07-.59 2.57-.38 5.43-1.87 5.92-7.58.4-.22.89-.57 1.1-.8.77-.76 1.09-2.52 1.05-5C23.93 2.67 20.65 0 18.93 0M3.23 9.13c-.24.29-.84 1.16-.9 1.24A9.67 9.67 0 0 1 2 7.08c.05-3.28 2.48-4.97 3.1-5.03.25.02.72.27 1.26.65A7.95 7.95 0 0 0 4 7.82c-.14.55-.4.86-.79 1.31M12 22c-.9 0-1.95-.7-2-1 0-.65.47-1.24 1-1.6v.6a1 1 0 1 0 2 0v-.6c.52.36 1 .95 1 1.6-.05.3-1.1 1-2 1m3-3.48v.02a4.75 4.75 0 0 0-1.26-1.02c1.09-.52 2.24-1.33 2.24-2.22 0-1.84-1.78-2.2-3.98-2.2s-3.98.36-3.98 2.2c0 .89 1.15 1.7 2.24 2.22A4.8 4.8 0 0 0 9 18.54v-.03a6.1 6.1 0 0 1-2.97-.84c-1.3-.92-1.84-3.04-1.86-6.48l.03-.04c.5-.82 1.49-1.45 1.8-3.1C6 6 7.36 4.42 8.36 3.53c1.01-.35 2.2-.53 3.59-.53 1.45 0 2.68.2 3.73.57 1 .9 2.32 2.46 2.32 4.48.31 1.65 1.3 2.27 1.8 3.1l.1.18c-.06 5.97-1.95 7.01-4.9 7.19m6.63-8.2l-.11-.2a7.59 7.59 0 0 0-.74-.98 3.02 3.02 0 0 1-.79-1.32 7.93 7.93 0 0 0-2.35-5.12c.53-.38 1-.63 1.26-.65.64.07 3.05 1.77 3.1 5.03.02 1.81-.35 3.22-.37 3.24",objects:"M12 0a9 9 0 0 0-5 16.5V21s2 3 5 3 5-3 5-3v-4.5A9 9 0 0 0 12 0zm0 2a7 7 0 1 1 0 14 7 7 0 0 1 0-14zM9 17.5a9 9 0 0 0 6 0v.8a7 7 0 0 1-3 .7 7 7 0 0 1-3-.7v-.8zm.2 3a8.9 8.9 0 0 0 2.8.5c1 0 1.9-.2 2.8-.5-.6.7-1.6 1.5-2.8 1.5-1.1 0-2.1-.8-2.8-1.5zm5.5-8.1c-.8 0-1.1-.8-1.5-1.8-.5-1-.7-1.5-1.2-1.5s-.8.5-1.3 1.5c-.4 1-.8 1.8-1.6 1.8h-.3c-.5-.2-.8-.7-1.3-1.8l-.2-1A3 3 0 0 0 7 9a1 1 0 0 1 0-2c1.7 0 2 1.4 2.2 2.1.5-1 1.3-2 2.8-2 1.5 0 2.3 1.1 2.7 2.1.2-.8.6-2.2 2.3-2.2a1 1 0 1 1 0 2c-.2 0-.3.5-.3.7a6.5 6.5 0 0 1-.3 1c-.5 1-.8 1.7-1.7 1.7",people:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24m0 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20M8 7a2 2 0 1 0 0 4 2 2 0 0 0 0-4m8 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-.8 8c-.7 1.2-1.8 2-3.3 2-1.5 0-2.7-.8-3.4-2H15m3-2H6a6 6 0 1 0 12 0",places:"M6.5 12a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5m0 3c-.3 0-.5-.2-.5-.5s.2-.5.5-.5.5.2.5.5-.2.5-.5.5m11-3a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5m0 3c-.3 0-.5-.2-.5-.5s.2-.5.5-.5.5.2.5.5-.2.5-.5.5m5-5.5l-1-.4-.1-.1h.6c.6 0 1-.4 1-1 0-1-.9-2-2-2h-.6l-.8-1.7A3 3 0 0 0 16.8 2H7.2a3 3 0 0 0-2.8 2.3L3.6 6H3a2 2 0 0 0-2 2c0 .6.4 1 1 1h.6v.1l-1 .4a2 2 0 0 0-1.4 2l.7 7.6a1 1 0 0 0 1 .9H3v1c0 1.1.9 2 2 2h2a2 2 0 0 0 2-2v-1h6v1c0 1.1.9 2 2 2h2a2 2 0 0 0 2-2v-1h1.1a1 1 0 0 0 1-.9l.7-7.5a2 2 0 0 0-1.3-2.1M6.3 4.9c.1-.5.5-.9 1-.9h9.5c.4 0 .8.4 1 .9L19.2 9H4.7l1.6-4.1zM7 21H5v-1h2v1zm12 0h-2v-1h2v1zm2.2-3H2.8l-.7-6.6.9-.4h18l.9.4-.7 6.6z",recent:"M13 4h-2v7H9v2h2v2h2v-2h4v-2h-4zm-1-4a12 12 0 1 0 0 24 12 12 0 0 0 0-24m0 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20",symbols:"M0 0h11v2H0zm4 11h3V6h4V4H0v2h4zm11.5 6a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m0-2.99a.5.5 0 0 1 0 .99c-.28 0-.5-.22-.5-.5s.22-.49.5-.49m6 5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5m0 2.99a.5.5 0 0 1-.5-.5.5.5 0 0 1 1 .01.5.5 0 0 1-.5.49m.5-9l-9 9 1.51 1.5 9-9zm-5-2c2.2 0 4-1.12 4-2.5V2s.98-.16 1.5.95C23 4.05 23 6 23 6s1-1.12 1-3.13C24-.02 21 0 21 0h-2v6.35A5.85 5.85 0 0 0 17 6c-2.2 0-4 1.12-4 2.5s1.8 2.5 4 2.5m-6.7 9.48L8.82 18.9a47.54 47.54 0 0 1-1.44 1.13c-.3-.3-.99-1.02-2.04-2.19.9-.83 1.47-1.46 1.72-1.89s.38-.87.38-1.33c0-.6-.27-1.18-.82-1.76-.54-.58-1.33-.87-2.35-.87-1 0-1.79.29-2.34.87-.56.6-.83 1.18-.83 1.79 0 .81.42 1.75 1.25 2.8a6.57 6.57 0 0 0-1.8 1.79 3.46 3.46 0 0 0-.51 1.83c0 .86.3 1.56.92 2.1a3.5 3.5 0 0 0 2.42.83c1.17 0 2.44-.38 3.81-1.14L8.23 24h2.82l-2.09-2.38 1.34-1.14zM3.56 14.1a1.02 1.02 0 0 1 .73-.28c.31 0 .56.08.75.25a.85.85 0 0 1 .28.66c0 .52-.42 1.11-1.26 1.78-.53-.65-.8-1.23-.8-1.74a.9.9 0 0 1 .3-.67m.18 7.9c-.43 0-.78-.12-1.06-.35-.28-.23-.41-.49-.41-.76 0-.6.5-1.3 1.52-2.09a31.23 31.23 0 0 0 2.25 2.44c-.92.5-1.69.76-2.3.76"},fi={search:"M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42 1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12z",delete:"M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"},Ci={search:"Search",emojilist:"List of emoji",notfound:"No Emoji Found",clear:"Clear",categories:{search:"Search Results",recent:"Frequently Used",people:"Smileys & People",nature:"Animals & Nature",foods:"Food & Drink",activity:"Activity",places:"Travel & Places",objects:"Objects",symbols:"Symbols",flags:"Flags",custom:"Custom"},skintones:{1:"Default Skin Tone",2:"Light Skin Tone",3:"Medium-Light Skin Tone",4:"Medium Skin Tone",5:"Medium-Dark Skin Tone",6:"Dark Skin Tone"}},yt=(()=>{class n{ngZone;renderer;ref;frequently;platformId;perLine=9;totalFrequentLines=4;i18n={};style={};title="Emoji Mart\u2122";emoji="department_store";darkMode=!!(typeof matchMedia=="function"&&matchMedia("(prefers-color-scheme: dark)").matches);color="#ae65c5";hideObsolete=!0;categories=[];activeCategories=[];set="apple";skin=1;isNative=!1;emojiSize=24;sheetSize=64;emojisToShowFilter;showPreview=!0;emojiTooltip=!1;autoFocus=!1;custom=[];hideRecent=!0;imageUrlFn;include;exclude;notFoundEmoji="sleuth_or_spy";categoriesIcons=_i;searchIcons=fi;useButton=!1;enableFrequentEmojiSort=!1;enableSearch=!0;showSingleCategory=!1;virtualize=!1;virtualizeOffset=0;recent;emojiClick=new w;emojiSelect=new w;skinChange=new w;scrollRef;previewRef;searchRef;categoryRefs;scrollHeight=0;clientHeight=0;clientWidth=0;selected;nextScroll;scrollTop;firstRender=!0;previewEmoji=null;animationFrameRequestId=null;NAMESPACE="emoji-mart";measureScrollbar=0;RECENT_CATEGORY={id:"recent",name:"Recent",emojis:null};SEARCH_CATEGORY={id:"search",name:"Search",emojis:null,anchor:!1};CUSTOM_CATEGORY={id:"custom",name:"Custom",emojis:[]};scrollListener;backgroundImageFn=(t,e)=>`https://cdn.jsdelivr.net/npm/emoji-datasource-${t}@14.0.0/img/${t}/sheets-256/${e}.png`;constructor(t,e,i,r,m){this.ngZone=t,this.renderer=e,this.ref=i,this.frequently=r,this.platformId=m}ngOnInit(){this.measureScrollbar=wn(),this.i18n=R(R({},Ci),this.i18n),this.i18n.categories=R(R({},Ci.categories),this.i18n.categories),this.skin=JSON.parse(le(this.platformId)&&localStorage.getItem(`${this.NAMESPACE}.skin`)||"null")||this.skin;let t=[..._t];this.custom.length>0&&(this.CUSTOM_CATEGORY.emojis=this.custom.map(d=>ee(R({},d),{id:d.shortNames[0],custom:!0})),t.push(this.CUSTOM_CATEGORY)),this.include!==void 0&&t.sort((d,g)=>this.include.indexOf(d.id)>this.include.indexOf(g.id)?1:-1);for(let d of t){let g=this.include&&this.include.length?this.include.indexOf(d.id)>-1:!0,A=this.exclude&&this.exclude.length?this.exclude.indexOf(d.id)>-1:!1;if(!(!g||A)){if(this.emojisToShowFilter){let T=[],{emojis:L}=d;for(let b=0;b<L.length;b++){let z=L[b];this.emojisToShowFilter(z)&&T.push(z)}if(T.length){let b={emojis:T,name:d.name,id:d.id};this.categories.push(b)}}else this.categories.push(d);this.categoriesIcons=R(R({},_i),this.categoriesIcons),this.searchIcons=R(R({},fi),this.searchIcons)}}let e=this.include&&this.include.length?this.include.indexOf(this.RECENT_CATEGORY.id)>-1:!0,i=this.exclude&&this.exclude.length?this.exclude.indexOf(this.RECENT_CATEGORY.id)>-1:!1;e&&!i&&(this.hideRecent=!1,this.categories.unshift(this.RECENT_CATEGORY)),this.categories[0]&&(this.categories[0].first=!0),this.categories.unshift(this.SEARCH_CATEGORY),this.selected=this.categories.filter(d=>d.first)[0].name;let r=Math.min(this.categories.length,3);this.setActiveCategories(this.activeCategories=this.categories.slice(0,r));let m=this.categories[r-1].emojis.slice();this.categories[r-1].emojis=m.slice(0,60),setTimeout(()=>{this.categories[r-1].emojis=m,this.setActiveCategories(this.categories),this.ref.detectChanges(),le(this.platformId)&&this.ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this.updateCategoriesSize()})})}),this.ngZone.runOutsideAngular(()=>{this.scrollListener=this.renderer.listen(this.scrollRef.nativeElement,"scroll",()=>{this.handleScroll()})})}ngOnDestroy(){this.scrollListener?.(),this.cancelAnimationFrame()}setActiveCategories(t){this.showSingleCategory?this.activeCategories=t.filter(e=>e.name===this.selected||e===this.SEARCH_CATEGORY):this.activeCategories=t}updateCategoriesSize(){if(this.categoryRefs.forEach(t=>t.memoizeSize()),this.scrollRef){let t=this.scrollRef.nativeElement;this.scrollHeight=t.scrollHeight,this.clientHeight=t.clientHeight,this.clientWidth=t.clientWidth}}handleAnchorClick(t){if(this.updateCategoriesSize(),this.selected=t.category.name,this.setActiveCategories(this.categories),this.SEARCH_CATEGORY.emojis){this.handleSearch(null),this.searchRef?.clear(),this.handleAnchorClick(t);return}let e=this.categoryRefs.find(i=>i.id===t.category.id);if(e){let{top:i}=e;t.category.first?i=0:i+=1,this.scrollRef.nativeElement.scrollTop=i}this.nextScroll=t.category.name;for(let i of this.categories)this.categoryRefs.find(({id:m})=>m===i.id)?.handleScroll(this.scrollRef.nativeElement.scrollTop)}categoryTrack(t,e){return e.id}handleScroll(t=!1){if(this.nextScroll){this.selected=this.nextScroll,this.nextScroll=void 0,this.ref.detectChanges();return}if(!this.scrollRef||this.showSingleCategory)return;let e;if(this.SEARCH_CATEGORY.emojis)e=this.SEARCH_CATEGORY;else{let i=this.scrollRef.nativeElement;if(i.scrollTop===0)e=this.categories.find(r=>r.first===!0);else if(i.scrollHeight-i.scrollTop===this.clientHeight)e=this.categories[this.categories.length-1];else for(let r of this.categories)this.categoryRefs.find(({id:g})=>g===r.id)?.handleScroll(i.scrollTop)&&(e=r);this.scrollTop=i.scrollTop}!t&&e&&e.name!==this.selected?(this.selected=e.name,this.ref.detectChanges()):t&&this.ref.detectChanges()}handleSearch(t){this.SEARCH_CATEGORY.emojis=t;for(let e of this.categoryRefs.toArray())e.name==="Search"?(e.emojis=t,e.updateDisplay(t?"block":"none")):e.updateDisplay(t?"none":"block");this.scrollRef.nativeElement.scrollTop=0,this.handleScroll()}handleEnterKey(t,e){if(!e&&this.SEARCH_CATEGORY.emojis!==null&&this.SEARCH_CATEGORY.emojis.length)if(e=this.SEARCH_CATEGORY.emojis[0],e)vt(this.emojiSelect,this.ngZone,{$event:t,emoji:e});else return;!this.hideRecent&&!this.recent&&e&&this.frequently.add(e);let i=this.categoryRefs.toArray()[1];i&&this.enableFrequentEmojiSort&&this.ngZone.run(()=>{i.updateRecentEmojis(),i.ref.markForCheck()})}handleEmojiOver(t){if(!this.showPreview||!this.previewRef)return;let e=this.CUSTOM_CATEGORY.emojis.find(i=>i.id===t.emoji.id);e&&(t.emoji=R({},e)),this.previewEmoji=t.emoji,this.cancelAnimationFrame(),this.ref.detectChanges()}handleEmojiLeave(){!this.showPreview||!this.previewRef||(this.animationFrameRequestId=requestAnimationFrame(()=>{this.previewEmoji=null,this.ref.detectChanges()}))}handleEmojiClick(t){vt(this.emojiClick,this.ngZone,t),vt(this.emojiSelect,this.ngZone,t),this.handleEnterKey(t.$event,t.emoji)}handleSkinChange(t){this.skin=t,localStorage.setItem(`${this.NAMESPACE}.skin`,String(t)),this.skinChange.emit(t)}getWidth(){return this.style&&this.style.width?this.style.width:this.perLine*(this.emojiSize+12)+12+2+this.measureScrollbar+"px"}cancelAnimationFrame(){this.animationFrameRequestId!==null&&(cancelAnimationFrame(this.animationFrameRequestId),this.animationFrameRequestId=null)}static \u0275fac=function(e){return new(e||n)(f(dt),f(Te),f(be),f(xi),f(mt))};static \u0275cmp=I({type:n,selectors:[["emoji-mart"]],viewQuery:function(e,i){if(e&1&&(H(Sn,7),H(xt,5),H(jt,5),H(St,5)),e&2){let r;q(r=G())&&(i.scrollRef=r.first),q(r=G())&&(i.previewRef=r.first),q(r=G())&&(i.searchRef=r.first),q(r=G())&&(i.categoryRefs=r)}},inputs:{perLine:"perLine",totalFrequentLines:"totalFrequentLines",i18n:"i18n",style:"style",title:"title",emoji:"emoji",darkMode:"darkMode",color:"color",hideObsolete:"hideObsolete",categories:"categories",activeCategories:"activeCategories",set:"set",skin:"skin",isNative:"isNative",emojiSize:"emojiSize",sheetSize:"sheetSize",emojisToShowFilter:"emojisToShowFilter",showPreview:"showPreview",emojiTooltip:"emojiTooltip",autoFocus:"autoFocus",custom:"custom",hideRecent:"hideRecent",imageUrlFn:"imageUrlFn",include:"include",exclude:"exclude",notFoundEmoji:"notFoundEmoji",categoriesIcons:"categoriesIcons",searchIcons:"searchIcons",useButton:"useButton",enableFrequentEmojiSort:"enableFrequentEmojiSort",enableSearch:"enableSearch",showSingleCategory:"showSingleCategory",virtualize:"virtualize",virtualizeOffset:"virtualizeOffset",recent:"recent",backgroundImageFn:"backgroundImageFn"},outputs:{emojiClick:"emojiClick",emojiSelect:"emojiSelect",skinChange:"skinChange"},standalone:!0,features:[ie],decls:8,vars:16,consts:[["scrollRef",""],[3,"ngStyle"],[1,"emoji-mart-bar"],[3,"anchorClick","categories","color","selected","i18n","icons"],[3,"i18n","include","exclude","custom","autoFocus","icons","emojisToShowFilter","searchResults","enterKeyOutsideAngular",4,"ngIf"],[1,"emoji-mart-scroll"],[3,"id","name","emojis","perLine","totalFrequentLines","hasStickyPosition","i18n","hideObsolete","notFoundEmoji","custom","recent","virtualize","virtualizeOffset","emojiIsNative","emojiSkin","emojiSize","emojiSet","emojiSheetSize","emojiForceSize","emojiTooltip","emojiBackgroundImageFn","emojiImageUrlFn","emojiUseButton","emojiOverOutsideAngular","emojiLeaveOutsideAngular","emojiClickOutsideAngular",4,"ngFor","ngForOf","ngForTrackBy"],["class","emoji-mart-bar",4,"ngIf"],[3,"searchResults","enterKeyOutsideAngular","i18n","include","exclude","custom","autoFocus","icons","emojisToShowFilter"],[3,"emojiOverOutsideAngular","emojiLeaveOutsideAngular","emojiClickOutsideAngular","id","name","emojis","perLine","totalFrequentLines","hasStickyPosition","i18n","hideObsolete","notFoundEmoji","custom","recent","virtualize","virtualizeOffset","emojiIsNative","emojiSkin","emojiSize","emojiSet","emojiSheetSize","emojiForceSize","emojiTooltip","emojiBackgroundImageFn","emojiImageUrlFn","emojiUseButton"],[3,"skinChange","emoji","idleEmoji","emojiIsNative","emojiSize","emojiSkin","emojiSet","i18n","emojiSheetSize","emojiBackgroundImageFn","emojiImageUrlFn"]],template:function(e,i){if(e&1){let r=k();a(0,"section",1)(1,"div",2)(2,"emoji-mart-anchors",3),C("anchorClick",function(d){return p(r),u(i.handleAnchorClick(d))}),c()(),_(3,xn,1,7,"emoji-search",4),a(4,"section",5,0),_(6,jn,1,23,"emoji-category",6),c(),_(7,yn,2,11,"div",7),c()}e&2&&(pt("emoji-mart ",i.darkMode?"emoji-mart-dark":"",""),oe("width",i.getWidth()),h("ngStyle",i.style),l(2),h("categories",i.categories)("color",i.color)("selected",i.selected)("i18n",i.i18n)("icons",i.categoriesIcons),l(),h("ngIf",i.enableSearch),l(),Q("aria-label",i.i18n.emojilist),l(2),h("ngForOf",i.activeCategories)("ngForTrackBy",i.categoryTrack),l(),h("ngIf",i.showPreview))},dependencies:[F,ce,Se,ht,Si,jt,xt,St],encapsulation:2,changeDetection:0})}return n})();function vt(n,o,t){n.observed&&o.run(()=>n.emit(t))}var Tn=[yt,Si,St,jt,xt,ji],yi=(()=>{class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=y({type:n});static \u0275inj=j({imports:[Tn]})}return n})();function Fn(n,o){if(n&1){let t=k();a(0,"emoji-mart",3),C("emojiSelect",function(i){p(t);let r=s();return u(r.onEmojiSelected(i))}),c()}if(n&2){let t=s();h("title","Pick your emoji\u2026")("emojiSize",24)("darkMode",!0)("backgroundImageFn",t.emojiSpriteImg)("custom",t.customEmojies)}}var Ge=(()=>{let o=class o{constructor(){this.onSelect=new w,this.emojiSpriteImg=Ut,this.emojiPopupOpen=!1,this.customEmojies=Ht}onEmojiSelected(e){let i=e.emoji,r=Bt(i)?`:${i.shortName}:`:i.native;r&&this.onSelect.emit(r)}togglePopup(e){this.emojiPopupOpen=e||!this.emojiPopupOpen}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=I({type:o,selectors:[["app-emoji-picker"]],outputs:{onSelect:"onSelect"},decls:4,vars:2,consts:[["emojiTrigger",""],[1,"emoji-picker",3,"click"],["cdkConnectedOverlay","",3,"overlayOutsideClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen"],[3,"emojiSelect","title","emojiSize","darkMode","backgroundImageFn","custom"]],template:function(i,r){if(i&1){let m=k();a(0,"button",1,0),C("click",function(g){return p(m),u(g.stopPropagation())})("click",function(){return p(m),u(r.emojiPopupOpen=!r.emojiPopupOpen)}),S(2,"\u{1F603}"),c(),_(3,Fn,1,5,"ng-template",2),C("overlayOutsideClick",function(){return p(m),u(r.emojiPopupOpen=!1)})}if(i&2){let m=Y(1);l(3),h("cdkConnectedOverlayOrigin",m)("cdkConnectedOverlayOpen",r.emojiPopupOpen)}},dependencies:[Wt,yt],styles:[".emoji-picker[_ngcontent-%COMP%]{height:100%;cursor:pointer}"]});let n=o;return n})();var $e=(()=>{let o=class o{constructor(e,i){this.htmlService=e,this._sanitizer=i}transform(e){let i=this.htmlService.textToHtml(e||"");return this._sanitizer.bypassSecurityTrustHtml(i)}};o.\u0275fac=function(i){return new(i||o)(f(ue,16),f(Vt,16))},o.\u0275pipe=J({name:"html",type:o,pure:!0});let n=o;return n})(),Ke=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({});let n=o;return n})();function Pn(n,o){n&1&&(a(0,"div",6),x(1,"img",7),c()),n&2&&(l(),h("src",o,N))}function An(n,o){if(n&1&&(_(0,Pn,2,1,"div",6),M(1,"decrypt"),M(2,"fullUrl")),n&2){let t,e=s(3);v(0,(t=W(2,3,P(1,1,o.avatarShortUrl),e.urlCategory.AVATAR))?0:-1,t)}}function Rn(n,o){if(n&1&&_(0,An,3,6),n&2){let t,e=o.$implicit,i=s(2);v(0,(t=i.userService.usersMap[e.authorId])?0:-1,t)}}function Vn(n,o){if(n&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"p",3),x(4,"span",4),M(5,"html"),c()(),a(6,"div",5),V(7,Rn,1,1,null,null,U),c()()()),n&2){let t=s();l(4),h("innerHTML",P(5,1,t.reactGrouped.text),Ee),l(3),D(t.reactGrouped.reacts)}}var Ti=(()=>{let o=class o{constructor(e){this.userService=e,this.urlCategory=de}};o.\u0275fac=function(i){return new(i||o)(f(me))},o.\u0275cmp=I({type:o,selectors:[["app-react"]],inputs:{reactGrouped:"reactGrouped"},decls:1,vars:1,consts:[[1,"react"],[1,"react__container"],[1,"react__content"],[1,"react__text"],[3,"innerHTML"],[1,"react__users"],[1,"react__picture"],["alt","\u0410\u0432\u0430\u0442\u0430\u0440",1,"react__avatar",3,"src"]],template:function(i,r){i&1&&_(0,Vn,9,3,"div",0),i&2&&v(0,r.reactGrouped?0:-1)},dependencies:[Le,Be,$e],styles:[".react[_ngcontent-%COMP%]{display:inline-flex;background-color:var(--gray-550);border-radius:16px;padding:4px 8px}.react__container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.react__users[_ngcontent-%COMP%], .react__picture[_ngcontent-%COMP%]{display:flex}.react__avatar[_ngcontent-%COMP%]{height:14px;width:14px;border-radius:50%}"]});let n=o;return n})();var je=function(n){return n[n.YELLOW_FACES=1]="YELLOW_FACES",n[n.PERSIK=2]="PERSIK",n[n.EGG_CHICK=3]="EGG_CHICK",n[n.BEAR_KID=4]="BEAR_KID",n}(je||{}),Ii="assets/images/stickers/",Fi=[{name:"\u0414\u043E\u0432\u0430\u043B\u044C\u043D\u0430\u044F \u043C\u043E\u0440\u0434\u0430",id:je.YELLOW_FACES,previewId:6,count:32},{name:"\u041A\u043E\u0442 \u041F\u0435\u0440\u0441\u0438\u043A",id:je.PERSIK,previewId:27,count:48},{name:"\u0416\u0435\u043B\u0442\u044B\u0439 \u0446\u044B\u043F\u043B\u0435\u043D\u043E\u043A",id:je.EGG_CHICK,previewId:2,count:40},{name:"\u041C\u0430\u043B\u0435\u043D\u044C\u043A\u0438\u0439 \u043C\u0435\u0434\u0432\u0435\u0436\u043E\u043D\u043E\u043A",id:je.BEAR_KID,previewId:4,count:32}];var Qe=(()=>{let o=class o{constructor(){this.path=Ii}transform(e){return`${this.path}${e[0]}/${e[1]}.png`}};o.\u0275fac=function(i){return new(i||o)},o.\u0275pipe=J({name:"sticker",type:o,pure:!0});let n=o;return n})(),Ye=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({});let n=o;return n})();function Ln(n,o){n&1&&(a(0,"div",4),x(1,"img",17),c()),n&2&&(l(),h("src",o,N))}function Nn(n,o){n&1&&(a(0,"span",18),S(1,"\u2713"),c())}function Bn(n,o){n&1&&(a(0,"span",19),S(1,"\u2713"),a(2,"span",20),S(3,"\u2713"),c()())}function Un(n,o){if(n&1&&x(0,"app-message",21),n&2){let t=o.$implicit;h("message",t)}}function Hn(n,o){if(n&1&&(a(0,"div",10),V(1,Un,1,1,"app-message",21,U),c()),n&2){let t=s(4);l(),D(t.message.forwarded)}}function qn(n,o){if(n&1&&(x(0,"img",11),M(1,"sticker")),n&2){let t=s(4);h("src",P(1,2,t.message.sticker),N)("alt","\u0421\u0442\u0438\u043A\u0435\u0440")}}function Gn(n,o){if(n&1&&(a(0,"p",12),x(1,"span",22),M(2,"decrypt"),M(3,"html"),c()),n&2){let t=s(4);l(),h("innerHTML",P(3,3,P(2,1,t.message.text)),Ee)}}function $n(n,o){if(n&1&&(x(0,"app-file-preview",23),M(1,"fullUrl")),n&2){let t=o.$implicit,e=s(5);h("fileSrc",W(1,2,t,e.urlCategory.ATTACHMENT))("height",240)}}function Kn(n,o){if(n&1&&(a(0,"div",13),V(1,$n,2,5,"app-file-preview",23,U),c()),n&2){let t=s(4);l(),D(t.message.fileShortUrls)}}function Qn(n,o){n&1&&(a(0,"span",14),S(1," (\u0440\u0435\u0434.)"),c())}function Yn(n,o){if(n&1){let t=k();a(0,"app-react",25),C("click",function(i){let r=p(t).$implicit,m=s(5);return i.stopPropagation(),u(m.onReactGroupedClick.emit(r))}),c()}if(n&2){let t=o.$implicit;h("reactGrouped",t)}}function Wn(n,o){if(n&1&&(a(0,"div",15),V(1,Yn,1,1,"app-react",24,U),c()),n&2){let t=s(4);l(),D(t.reactGroupedList)}}function Zn(n,o){if(n&1){let t=k();a(0,"button",30),C("click",function(){p(t);let i=s(6);return u(i.onEdit.emit())}),S(1,"\u270F\uFE0F"),c()}}function Jn(n,o){if(n&1){let t=k();_(0,Zn,2,0,"button",28),a(1,"button",29),C("click",function(){p(t);let i=s(5);return u(i.onDelete.emit())}),S(2,"\u{1F5D1}\uFE0F"),c()}if(n&2){let t=s(5);v(0,t.message.text||t.message.fileShortUrls!=null&&t.message.fileShortUrls.length?0:-1)}}function Xn(n,o){if(n&1){let t=k();a(0,"div",16)(1,"app-emoji-picker",26,0),C("onSelect",function(i){p(t);let r=Y(2);return s(4).onEmojiSelected(i),u(r.togglePopup(!1))}),c(),_(3,Jn,3,1,"button",27),c()}if(n&2){let t=s(),e=s(3);l(3),v(3,e.message.authorId===t.id?3:-1)}}function eo(n,o){if(n&1&&(a(0,"div",2)(1,"div",3),_(2,Ln,2,1,"div",4),M(3,"decrypt"),M(4,"fullUrl"),a(5,"div",5)(6,"div",6)(7,"h5",7),S(8),M(9,"decrypt"),c(),a(10,"time",8),S(11),M(12,"date"),c(),_(13,Nn,2,0)(14,Bn,4,0),c(),a(15,"div",9),_(16,Hn,3,0,"div",10)(17,qn,2,4,"img",11)(18,Gn,4,5,"p",12)(19,Kn,3,0,"div",13)(20,Qn,2,0,"span",14)(21,Wn,3,0,"div",15),c()()(),_(22,Xn,4,1,"div",16),c()),n&2){let t,e,i=s(),r=s(2);B("message--selected",r.selected),l(2),v(2,(t=W(4,15,P(3,13,i.avatarShortUrl),r.urlCategory.AVATAR))?2:-1,t),l(6),X(P(9,18,i.name)),l(3),X(W(12,20,r.message.createTs,"dd.MM.YYYY HH:mm")),l(2),v(13,(e=r.status)===r.eStatus.SEND?13:e===r.eStatus.READ?14:-1),l(3),v(16,r.message.forwarded&&r.message.forwarded.length?16:-1),l(),v(17,r.message.sticker?17:-1),l(),v(18,r.message.text?18:-1),l(),v(19,r.message.fileShortUrls!=null&&r.message.fileShortUrls.length?19:-1),l(),v(20,r.message.edited?20:-1),l(),v(21,r.reacts&&r.reacts.length?21:-1),l(),v(22,r.selected?22:-1)}}function to(n,o){if(n&1&&_(0,eo,23,23,"div",1),n&2){let t,e=s(2);v(0,(t=e.userService.currentUser)?0:-1,t)}}function io(n,o){if(n&1&&_(0,to,1,1),n&2){let t,e=s();v(0,(t=e.userService.usersMap[e.message.authorId])?0:-1,t)}}var We=(()=>{let o=class o{constructor(e,i){this.userService=e,this.reactService=i,this.reacts=[],this.status=gt.NONE,this.selected=!1,this.onDelete=new w,this.onEdit=new w,this.onRender=new w,this.onReact=new w,this.onReactGroupedClick=new w,this.reactGroupedList=[],this.urlCategory=de,this.eStatus=gt}ngAfterViewInit(){this.onRender.emit()}ngOnChanges(){this.reacts&&this.reacts.length&&(this.reactGroupedList=this.reactService.getReactGroupedList(this.reacts))}onEmojiSelected(e){this.onReact.emit({text:e})}};o.\u0275fac=function(i){return new(i||o)(f(me),f(ze))},o.\u0275cmp=I({type:o,selectors:[["app-message"]],inputs:{message:"message",reacts:"reacts",status:"status",selected:"selected"},outputs:{onDelete:"onDelete",onEdit:"onEdit",onRender:"onRender",onReact:"onReact",onReactGroupedClick:"onReactGroupedClick"},features:[te],decls:1,vars:1,consts:[["emojiPicker",""],[1,"message",3,"message--selected"],[1,"message"],[1,"message__box"],[1,"message__picture"],[1,"message__content"],[1,"message__header"],[1,"message__author","font-head-14"],[1,"message__date","font-basic-11"],[1,"message__body"],[1,"message__forwarded"],[1,"message__sticker",3,"src","alt"],[1,"message__text","font-basic-14"],[1,"message__files"],[1,"message__edited","font-basic-12"],[1,"message__reacts"],[1,"message__controls"],["alt","\u0410\u0432\u0430\u0442\u0430\u0440",1,"message__avatar",3,"src"],[1,"font-basic-12"],[1,"font-basic-12",2,"color","lightgreen"],[2,"margin-left","-5px"],[3,"message"],[3,"innerHTML"],[1,"message__file",3,"fileSrc","height"],[1,"message__react",3,"reactGrouped"],[1,"message__react",3,"click","reactGrouped"],[3,"onSelect"],[1,"message__delete"],[1,"message__edit"],[1,"message__delete",3,"click"],[1,"message__edit",3,"click"]],template:function(i,r){i&1&&_(0,io,1,1),i&2&&v(0,r.message?0:-1)},dependencies:[qe,Ge,Ti,o,Rt,Be,Le,$e,Qe],styles:[".message[_ngcontent-%COMP%]{position:relative;display:flex;border-radius:4px}.message--selected[_ngcontent-%COMP%]{background-color:var(--gray-600)}.message__box[_ngcontent-%COMP%]{padding:4px;border-radius:6px;display:flex;gap:8px;max-width:min(100%,600px)}.message__avatar[_ngcontent-%COMP%]{height:30px;width:30px;border-radius:50%}.message__content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:4px}.message__header[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.message__body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;word-break:break-word}.message__forwarded[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;border-left:2px solid var(--gray-500);padding-left:4px}.message__author[_ngcontent-%COMP%]{color:var(--accent-450)}.message__sticker[_ngcontent-%COMP%]{width:128px;height:128px;pointer-events:none;-webkit-user-select:none;user-select:none}.message__files[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:12px}.message__date[_ngcontent-%COMP%]{color:var(--gray-300)}.message__edited[_ngcontent-%COMP%]{color:var(--gray-350)}.message__controls[_ngcontent-%COMP%]{position:absolute;right:6px;top:6px;display:flex;align-items:center;gap:8px}.message__reacts[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}"]});let n=o;return n})();function oo(n,o){if(n&1&&x(0,"app-message",0),n&2){let t=o.$implicit;h("message",t)}}function ro(n,o){if(n&1&&V(0,oo,1,1,"app-message",0,U),n&2){let t=s();D(t.messages)}}var Pi=(()=>{let o=class o{constructor(e,i){this.data=e,this.dialogRef=i,this.messages=[],e&&(this.messages=e)}};o.\u0275fac=function(i){return new(i||o)(f(Xt,8),f(Jt,8))},o.\u0275cmp=I({type:o,selectors:[["app-message-list"]],decls:1,vars:1,consts:[[3,"message"]],template:function(i,r){i&1&&_(0,ro,2,0),i&2&&v(0,r.data?0:-1)},dependencies:[We]});let n=o;return n})();var Ai=(()=>{let o=class o{constructor(){this.messagesTextKey="messageTextMap"}getMessageTextByChatId(e){let i=this.messagesText[e];if(i){let r=Pe(i);if(r)return r}return""}setMessageTextByChatId(e,i){this.messagesText=ee(R({},this.messagesText),{[e]:i?zt(i):void 0})}get messagesText(){let e=localStorage.getItem(this.messagesTextKey);if(e)try{let i=JSON.parse(e);if(typeof i=="object"&&i!==null&&Object.keys(i).length>0)return i}catch{return{}}return{}}set messagesText(e){localStorage.setItem(this.messagesTextKey,JSON.stringify(e))}};o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=ve({token:o,factory:o.\u0275fac,providedIn:"root"});let n=o;return n})();var Ze=(()=>{let o=class o{constructor(){this.id="editor-id-"+o.uniqueId++,this.label="",this.required=!1,this.disabled=!1,this.readonly=!1,this.tooltip="",this.error="",this.model=null,this.onChange=()=>{},this.onTouched=()=>{}}updateModel(e){this.model=e,this.onChange(this.model)}writeValue(e){this.model=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e}};o.uniqueId=0,o.\u0275fac=function(i){return new(i||o)},o.\u0275dir=Me({type:o,inputs:{id:"id",label:"label",required:"required",disabled:"disabled",readonly:"readonly",tooltip:"tooltip",error:"error",model:[Ft.None,"value","model"]}});let n=o;return n})();var Ri=(()=>{let o=class o extends Ze{onPaste(e){let i=e.clipboardData;i&&i.files.length&&e.preventDefault()}onInput(e){if(e.inputType==="insertFromPaste"){let i=this.htmlService.textToHtml(this.elementRef.nativeElement.innerHTML);this.elementRef.nativeElement.innerHTML=i}this.observer?.disconnect(),this.onChange(this.elementRef.nativeElement.innerHTML)}onKeyDown(e){e.key==="Shift"&&this.shiftKeyPressed===!1&&(this.shiftKeyPressed=!0),e.key==="Enter"&&this.shiftKeyPressed===!1&&e.preventDefault()}onKeyUp(e){e.key==="Shift"&&(this.shiftKeyPressed=!1),e.key==="Enter"&&this.shiftKeyPressed===!1&&this.onEnterPress.emit()}onBlur(){this.onTouched()}constructor(e,i,r){super(),this.elementRef=e,this.renderer=i,this.htmlService=r,this.onEnterPress=new w,this.shiftKeyPressed=!1,this.renderer.setAttribute(this.elementRef.nativeElement,"contenteditable","true")}ngAfterViewInit(){this.observer=new MutationObserver(()=>{this.onChange(this.elementRef.nativeElement.innerHTML)}),this.observer.observe(this.elementRef.nativeElement,{characterData:!0,childList:!0,subtree:!0})}ngOnDestroy(){this.observer?.disconnect()}writeValue(e){this.renderer.setProperty(this.elementRef.nativeElement,"innerHTML",this.htmlService.textToHtml(e))}setDisabledState(e){this.renderer.setAttribute(this.elementRef.nativeElement,"contenteditable",String(!e)),this.disabled=e}};o.\u0275fac=function(i){return new(i||o)(f(Ot),f(Te),f(ue))},o.\u0275dir=Me({type:o,selectors:[["","contenteditable","","formControlName",""],["","contenteditable","","formControl",""],["","contenteditable","","ngModel",""]],hostBindings:function(i,r){i&1&&C("paste",function(d){return r.onPaste(d)})("input",function(d){return r.onInput(d)})("keydown",function(d){return r.onKeyDown(d)})("keyup",function(d){return r.onKeyUp(d)})("blur",function(){return r.onBlur()})},outputs:{onEnterPress:"onEnterPress"},features:[Fe([{provide:He,useExisting:we(()=>o),multi:!0}]),Ie]});let n=o;return n})(),Vi=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({});let n=o;return n})();var co=(n,o)=>o.id,Di=(n,o)=>[n,o];function lo(n,o){if(n&1){let t=k();a(0,"button",6),C("click",function(){let i=p(t).$implicit,r=s(2);return u(r.onSelect.emit([r.pack.id,i]))}),x(1,"img",7),M(2,"sticker"),c()}if(n&2){let t=o.$implicit,e=s(2);l(),h("src",P(2,1,ut(3,Di,e.pack.id,t)),N)}}function mo(n,o){if(n&1&&(a(0,"div",2),V(1,lo,3,6,"button",5,U),c()),n&2){let t=s();l(),D(t.stickers)}}function po(n,o){if(n&1){let t=k();a(0,"button",8),C("click",function(i){let r=p(t).$implicit,m=s();return u(m.selectPack(r,i))}),x(1,"img",9),M(2,"sticker"),c()}if(n&2){let t=o.$implicit,e=s();B("sticker--selected",e.pack&&e.pack.id===t.id),l(),h("src",P(2,4,ut(6,Di,t.id,t.previewId)),N)("title",t.name)}}var zi=(()=>{let o=class o{get stickers(){return this.pack?[...Array(this.pack.count).keys()].map(e=>e+1):[]}constructor(){this.onSelect=new w,this.packs=Fi,this.pack=this.packs.length?this.packs[0]:void 0}selectPack(e,i){i.stopPropagation(),this.pack=e}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=I({type:o,selectors:[["app-sticker-picker"]],outputs:{onSelect:"onSelect"},decls:6,vars:1,consts:[[1,"picker"],[1,"picker__body"],[1,"picker__stickers","custom-scrollbar"],[1,"picker__footer"],[1,"sticker","sticker--pack",3,"sticker--selected"],[1,"sticker"],[1,"sticker",3,"click"],[1,"sticker__img",3,"src"],[1,"sticker","sticker--pack",3,"click"],[1,"sticker__img",3,"src","title"]],template:function(i,r){i&1&&(a(0,"div",0)(1,"div",1),_(2,mo,3,0,"div",2),c(),a(3,"div",3),V(4,po,3,9,"button",4,co),c()()),i&2&&(l(2),v(2,r.pack?2:-1),l(2),D(r.packs))},dependencies:[Qe],styles:[".picker[_ngcontent-%COMP%]{background-color:var(--gray-550);border:1px solid var(--gray-450);border-radius:4px;--sticker-cols: 4;--sticker-rows: 5;--sticker-gap: 6px;--sticker-size: 86px;--sticker-opacity: .9;--pack-size: 44px}.picker__body[_ngcontent-%COMP%]{padding:12px}.picker__stickers[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(var(--sticker-cols),1fr);max-height:calc((var(--sticker-size) + var(--sticker-gap)) * var(--sticker-rows));overflow:hidden auto;gap:var(--sticker-gap)}.picker__footer[_ngcontent-%COMP%]{display:flex;gap:8px;padding:12px;border-top:1px solid var(--gray-450)}.sticker[_ngcontent-%COMP%]{display:flex;background-color:unset;border:none;cursor:pointer;padding:4px;border-radius:6px;width:var(--sticker-size);height:var(--sticker-size)}.sticker--pack[_ngcontent-%COMP%]{width:var(--pack-size);height:var(--pack-size)}.sticker--selected[_ngcontent-%COMP%]{background-color:var(--gray-450);--sticker-opacity: 1}.sticker[_ngcontent-%COMP%]:hover:not(.sticker--selected){background-color:var(--gray-500);--sticker-opacity: 1}.sticker__img[_ngcontent-%COMP%]{width:100%;height:100%;opacity:var(--sticker-opacity)}"]});let n=o;return n})();var ho=["textareaWrapper"];function go(n,o){if(n&1){let t=k();a(0,"div",16),x(1,"app-file-preview",17),a(2,"button",18),C("click",function(){let i=p(t).$index,r=s(2);return u(r.fileSrcList.splice(i,1))}),S(3,"x"),c()()}if(n&2){let t=o.$implicit;l(),h("fileSrc",t)("height",100)}}function _o(n,o){if(n&1&&(a(0,"div",15),V(1,go,4,2,"div",16,U),c()),n&2){let t=s();B("message-input__files--hidden",t.dragActive),l(),D(t.fileSrcList)}}var Li=(()=>{let o=class o extends Ze{constructor(e){super(),this.fileService=e,this.textareaWrapper=null,this.fileSrcList=[],this.onEnterPress=new w,this.onSubmit=new w,this.onStickerSelect=new w,this.onFileSrcListSelect=new w,this.dragActive=!1}onEmojiSelected(e){this.model+=e,this.updateModel(this.model)}onDragOver(e){this.resetDragEvent(e),this.dragActive=!0}onDragLeave(e){this.resetDragEvent(e),this.dragActive=!1}onDrop(e){this.resetDragEvent(e),this.dragActive=!1,this.handleFileList(e.dataTransfer?.files)}onPaste(e){let i=e.clipboardData;i&&i.files.length&&this.handleFileList(i.files)}onFilesUploaded(e){this.handleFileList(e.target.files)}handleFileList(e){if(e){let i=this.fileService.fileListToFiles(e);this.fileSrcList=[...this.fileSrcList,...this.fileService.getValidFiles(i,this.fileService.messageCategories)],this.onFileSrcListSelect.next(this.fileSrcList)}}resetDragEvent(e){e.preventDefault(),e.stopPropagation()}};o.\u0275fac=function(i){return new(i||o)(f(pe))},o.\u0275cmp=I({type:o,selectors:[["app-message-input"]],viewQuery:function(i,r){if(i&1&&H(ho,5),i&2){let m;q(m=G())&&(r.textareaWrapper=m.first)}},inputs:{fileSrcList:"fileSrcList"},outputs:{onEnterPress:"onEnterPress",onSubmit:"onSubmit",onStickerSelect:"onStickerSelect",onFileSrcListSelect:"onFileSrcListSelect"},features:[Fe([{provide:He,useExisting:we(()=>o),multi:!0}]),Ie],decls:20,vars:7,consts:[["uploadInput",""],["textareaWrapper",""],["stickerMenu","matMenu"],[1,"message-input"],["type","file",1,"visually-hidden",3,"change","accept","multiple"],[1,"message-input__container",3,"dragover","dragleave","drop"],[1,"message-input__drag","font-basic-14"],[1,"message-input__controls"],[1,"message-input__btn","message-input__image",3,"click"],["contenteditable","","role","textbox",1,"message-input__textarea","custom-scrollbar","font-basic-14",3,"ngModelChange","onEnterPress","paste","ngModel"],[1,"message-input__btn","message-input__emoji",3,"onSelect"],[1,"message-input__btn","message-input__sticker",3,"matMenuTriggerFor"],[1,"message-input__btn","message-input__send",3,"click"],[1,"message-input__files",3,"message-input__files--hidden"],[3,"onSelect"],[1,"message-input__files"],[1,"file"],[1,"file__preview",3,"fileSrc","height"],[1,"file__delete",3,"click"]],template:function(i,r){if(i&1){let m=k();a(0,"div",3)(1,"input",4,0),C("change",function(g){return p(m),u(r.onFilesUploaded(g))}),c(),a(3,"div",5),C("dragover",function(g){return p(m),u(r.onDragOver(g))})("dragleave",function(g){return p(m),u(r.onDragLeave(g))})("drop",function(g){return p(m),u(r.onDrop(g))}),a(4,"div",6),S(5," \u041F\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0441\u044E\u0434\u0430 \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438 \u0447\u0442\u043E\u0431\u044B \u043F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0438\u0445 \u043A \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044E "),c(),a(6,"div",7)(7,"button",8),C("click",function(){p(m);let g=Y(2);return u(g.click())}),S(8,"\u{1F4CE}"),c(),a(9,"div",9,1),ae("ngModelChange",function(g){return p(m),se(r.model,g)||(r.model=g),u(g)}),C("ngModelChange",function(g){return p(m),u(r.updateModel(g))})("onEnterPress",function(){return p(m),u(r.onEnterPress.emit())})("paste",function(g){return p(m),u(r.onPaste(g))}),c(),a(11,"app-emoji-picker",10),C("onSelect",function(g){return p(m),u(r.onEmojiSelected(g))}),c(),a(12,"button",11),S(13,"\u{1F5BC}\uFE0F"),c(),a(14,"button",12),C("click",function(){return p(m),u(r.onSubmit.next())}),S(15,"\u279C"),c()(),_(16,_o,3,2,"div",13),c()(),a(17,"mat-menu",null,2)(19,"app-sticker-picker",14),C("onSelect",function(g){return p(m),u(r.onStickerSelect.emit(g))}),c()()}if(i&2){let m=Y(18);l(),h("accept",r.fileService.messageAccept)("multiple",!0),l(3),B("message-input__drag--active",r.dragActive),l(5),re("ngModel",r.model),l(3),h("matMenuTriggerFor",m),l(4),v(16,r.fileSrcList.length?16:-1)}},dependencies:[ge,_e,ni,oi,Ri,zi,qe,Ge],styles:[".message-input[_ngcontent-%COMP%]{--textarea-max-rows: 4;--textarea-padding: 6px;--textarea-text-size: 20px;--textarea-min-height: calc(var(--textarea-text-size) + (var(--textarea-padding) * 2));--textarea-max-height: calc((var(--textarea-text-size) * var(--textarea-max-rows)) + (var(--textarea-padding) * 2))}.message-input__container[_ngcontent-%COMP%]{position:relative}.message-input__drag[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background-color:var(--gray-450);border:1px dotted var(--gray-300);opacity:0;pointer-events:none}.message-input__drag--active[_ngcontent-%COMP%]{opacity:1}.message-input__files[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;padding:12px;gap:8px}.message-input__files--hidden[_ngcontent-%COMP%]{opacity:0}.message-input__controls[_ngcontent-%COMP%]{display:flex;gap:4px}.message-input__textarea[_ngcontent-%COMP%]{flex-grow:1;outline:none;background-color:var(--gray-600);border:1px solid var(--gray-500);padding:var(--textarea-padding);min-height:var(--textarea-min-height);max-height:var(--textarea-max-height);overflow-y:auto}.message-input__btn[_ngcontent-%COMP%]{cursor:pointer}.file[_ngcontent-%COMP%]{position:relative;display:flex}.file__delete[_ngcontent-%COMP%]{position:absolute;top:2px;right:2px;cursor:pointer}"]});let n=o;return n})();var Ni=(()=>{let o=class o{constructor(e){this.messageService=e}transform(e,i,r){return this.messageService.getMessageStatus(i,e,r)}};o.\u0275fac=function(i){return new(i||o)(f(De,16))},o.\u0275pipe=J({name:"messageStatus",type:o,pure:!1});let n=o;return n})(),Bi=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({});let n=o;return n})();var xo=["scrollAnchor"],jo=(n,o)=>o.id;function yo(n,o){n&1&&(a(0,"div",2),x(1,"app-loader"),c())}function ko(n,o){if(n&1){let t=k();a(0,"button",9),C("click",function(){p(t);let i=s(2);return u(i.forwardMessages(!0))}),S(1,"\u041F\u0435\u0440\u0435\u0441\u043B\u0430\u0442\u044C \u0441\u044E\u0434\u0430"),c(),a(2,"button",9),C("click",function(){p(t);let i=s(2);return u(i.forwardMessages())}),S(3,"\u041F\u0435\u0440\u0435\u0441\u043B\u0430\u0442\u044C"),c(),a(4,"button",9),C("click",function(){p(t);let i=s(2);return u(i.selectedMessagesMap={})}),S(5,"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C"),c(),a(6,"span"),S(7),c()}if(n&2){let t=s(2);l(7),$("\u0412\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439: ",t.selectedMessages.length,"")}}function wo(n,o){if(n&1){let t=k();a(0,"button",9),C("click",function(){p(t);let i=s(2);return u(i.onCloseChat())}),S(1,"\u041D\u0430\u0437\u0430\u0434"),c(),a(2,"app-list-item",10),M(3,"chatInfo"),M(4,"chatInfo"),M(5,"online"),C("onTextClick",function(){p(t);let i=s(2);return u(i.openMembersPreview(i.chat.members))}),c()}if(n&2){let t=s(2);l(2),h("avatar",W(3,5,t.chat,t.chatInfo.AVATAR))("caption",W(4,8,t.chat,t.chatInfo.NAME))("online",P(5,11,t.chat))("text",t.chatPreviewText)("minimize",!0)}}function Mo(n,o){if(n&1){let t=k();a(0,"app-message",13),M(1,"messageStatus"),C("onDelete",function(){let i=p(t).$implicit,r=s(3);return u(r.onDeleteMessage(i))})("onEdit",function(){let i=p(t).$implicit,r=s(3);return u(r.onEditMessage(i))})("onRender",function(){let i=p(t).$implicit,r=s(3);return u(r.onRenderMessage(i))})("onReact",function(i){let r=p(t).$implicit,m=s(3);return u(m.onAddReact(r.chatId,r.msgId,i))})("onReactGroupedClick",function(i){p(t);let r=s(3);return u(r.onReactGroupedClick(i))})("click",function(){let i=p(t).$implicit,r=s(3);return u(r.selectMessage(i))}),c()}if(n&2){let t=o.$implicit,e=s(3);h("message",t)("reacts",e.reactsMap[t.msgId])("selected",e.selectedMessagesMap[t.msgId]!==void 0)("status",Pt(1,4,t,e.chat,e.messages.length))}}function Eo(n,o){n&1&&(a(0,"span",12),S(1,"\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439 \u0435\u0449\u0435 \u043D\u0435\u0442"),c())}function To(n,o){if(n&1&&V(0,Mo,2,8,"app-message",11,jo,!1,Eo,2,0,"span",12),n&2){let t=s(2);D(t.messages)}}function Io(n,o){if(n&1){let t=k();a(0,"span",15),C("click",function(){p(t);let i=s(3);return u(i.openMessagesPreview(i.forwardedMessages))}),S(1),c()}if(n&2){let t=s(3);l(),$("\u041F\u0435\u0440\u0435\u0441\u043B\u0430\u043D\u043D\u044B\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F: ",t.forwardedMessages.length,"")}}function Fo(n,o){if(n&1){let t=k();a(0,"span",15),C("click",function(){p(t);let i=s(3);return u(i.openMessagesPreview([i.editingMessage]))}),S(1,"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u0443\u0435\u043C\u043E\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435"),c()}}function bo(n,o){if(n&1){let t=k();a(0,"div",8),_(1,Io,2,1,"span",14)(2,Fo,2,0,"span",14),a(3,"button",9),C("click",function(){p(t);let i=s(2);return u(i.resetChatData())}),S(4,"x"),c()()}if(n&2){let t=s(2);l(),v(1,t.forwardedMessages.length?1:-1),l(),v(2,t.editingMessage?2:-1)}}function Oo(n,o){if(n&1){let t=k();a(0,"div",1),_(1,yo,2,0,"div",2),a(2,"div",3),_(3,ko,8,1)(4,wo,6,13),c(),a(5,"div",4)(6,"div",5),_(7,To,3,1),x(8,"div",null,0),c(),a(10,"div",6)(11,"app-message-input",7),ae("ngModelChange",function(i){p(t);let r=s();return se(r.msgText,i)||(r.msgText=i),u(i)}),C("ngModelChange",function(i){p(t);let r=s();return u(r.onMsgTextChange(i))})("onFileSrcListSelect",function(i){p(t);let r=s();return u(r.fileSrcList=i)})("onStickerSelect",function(i){p(t);let r=s();return u(r.sendSticker(i))})("onEnterPress",function(){p(t);let i=s();return u(i.sendMessage())})("onSubmit",function(){p(t);let i=s();return u(i.sendMessage())}),c(),_(12,bo,5,2,"div",8),c()()()}if(n&2){let t=s();l(),v(1,t.sending?1:-1),l(2),v(3,t.selectedMessages.length?3:4),l(4),v(7,t.messages?7:-1),l(4),h("fileSrcList",t.fileSrcList),re("ngModel",t.msgText),l(),v(12,t.forwardedMessages.length||t.editingMessage?12:-1)}}var Ui=(()=>{let o=class o{get selectedMessages(){return Object.values(this.selectedMessagesMap).filter(e=>e)}get chatPreviewText(){if(this.chat)if(this.chat.type===Lt.PRIVATE){let e=this.activityService.isOnline(this.chat);return`<span class="font-basic-12" style="color: ${e?"lightgreen":"var(--gray-300)"}">${e?"online":"offline"}</span>`}else return`<a class="link">\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u043E\u0432: ${this.chat.members.length}</a>`;return""}constructor(e,i,r,m,d,g,A,T,L,b,z){this.dialog=e,this.chatService=i,this.messageService=r,this.htmlService=m,this.fileService=d,this.userService=g,this.selectionService=A,this.activityService=T,this.reactService=L,this.cacheService=b,this.toastr=z,this.scrollAnchor=null,this.subscription=new rt,this.sending=!1,this.selectedMessagesMap={},this.msgText="",this.fileSrcList=[],this.forwardedMessages=[],this.reactsMap={},this.urlCategory=de.ATTACHMENT,this.chatInfo=Ae}ngOnChanges(){this.chat&&(this.chatService.currentChatId=this.chat.id,this.chatService.resetChatUnread(this.chat),this.forwardedMessages=this.messageService.forwardedMap[this.chat.id]||[],this.msgText=this.cacheService.getMessageTextByChatId(this.chat.id),this.selectedMessagesMap={},this.messages=void 0,this.subscription.unsubscribe(),this.subscription=new rt,this.subscription.add(this.messageService.getChatMessages$(this.chat.id).subscribe(e=>{this.messages||this.scrollDown("auto"),this.messages&&e.length>this.messages.length&&(this.messageAwaitingScroll=e[e.length-1],this.chat&&this.chatService.resetChatUnread(this.chat,!0)),this.messages=e})),this.subscription.add(this.reactService.getChatReacts$(this.chat.id).subscribe(e=>{this.reactsMap={},e.forEach(i=>{this.reactsMap[i.msgId]===void 0&&(this.reactsMap[i.msgId]=[]),this.reactsMap[i.msgId]?.push(i)})})))}ngOnDestroy(){this.subscription.unsubscribe()}onMsgTextChange(e){if(this.chat){let i=this.htmlService.htmlToText(e);this.cacheService.setMessageTextByChatId(this.chat.id,i)}}onRenderMessage(e){this.messageAwaitingScroll&&this.messageAwaitingScroll===e&&this.scrollDown("smooth")}openMessagesPreview(e){this.dialog.open(Pi,{panelClass:"",autoFocus:!1,width:"400px",height:"50vh",data:e})}openMembersPreview(e){let i=[];e.forEach(m=>{let d=this.userService.usersMap[m];d&&i.push(d)});let r={caption:"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u0438 \u0447\u0430\u0442\u0430",mode:Ct.SINGLE,items:i,readonly:!0,noItemsText:"\u041D\u0435\u0442 \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u043E\u0432",expr:{id:"id",caption:"name",avatar:"avatarShortUrl"}};this.selectionService.openDialog(r)}forwardMessages(e){if(this.chat&&e){this.messageService.forwardedMap[this.chat.id]=this.selectedMessages,this.selectedMessagesMap={},this.forwardedMessages=this.messageService.forwardedMap[this.chat.id]||[];return}let i=Object.values(this.chatService.chatsMap).filter(d=>d).map(d=>ee(R({},d),{name:this.chatService.getChatAbout(d,Ae.NAME),avatarShortUrl:this.chatService.getChatAbout(d,Ae.AVATAR)})),r={caption:"\u0412\u044B\u0431\u043E\u0440 \u0447\u0430\u0442\u0430",mode:Ct.SINGLE,items:i,noItemsText:"\u041D\u0435\u0442 \u0447\u0430\u0442\u043E\u0432",expr:{id:"id",caption:"name",avatar:"avatarShortUrl"}};this.selectionService.openDialog(r).afterClosed().subscribe(d=>{if(d?.items.length){let g=d.items[0];this.messageService.forwardedMap[g.id]=this.selectedMessages,this.selectedMessagesMap={},this.chat&&this.chat.id===g.id?this.forwardedMessages=this.messageService.forwardedMap[this.chat.id]||[]:this.chatService.openChat(g.id)}})}selectMessage(e){let i=this.selectedMessagesMap[e.msgId];this.selectedMessagesMap[e.msgId]=i===void 0?e:void 0}onCloseChat(){this.chatService.closeChat()}onDeleteMessage(e){this.chat&&this.messageService.deleteMessage(this.chat,e).subscribe()}onEditMessage(e){if(this.editingMessage=e,this.msgText="",this.fileSrcList=[],e.text){let i=Pe(e.text);i&&(this.msgText=i)}e.fileShortUrls&&e.fileShortUrls.length&&(this.fileSrcList=e.fileShortUrls.map(i=>this.fileService.getFullUrl(i,this.urlCategory)))}onAddReact(e,i,r){this.reactService.addReact(e,i,r).subscribe()}onReactGroupedClick(e){if(e.reacts.length){let i=this.reactService.getUserReact(e.reacts,e.text);if(i)this.reactService.deleteReact(i).subscribe();else{let r=e.reacts[0];this.onAddReact(r.chatId,r.msgId,{text:e.text})}}}onMessageSelected(e){this.selectedMessagesMap[e.msgId]=this.selectedMessagesMap[e.msgId]===void 0?e:void 0}sendSticker(e){this.chat&&(this.sending=!0,this.messageService.sendMessage(this.chat,{sticker:e}).subscribe(()=>{this.sending=!1,console.log("\u0421\u0442\u0438\u043A\u0435\u0440 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D")}))}sendMessage(){let e=this.htmlService.htmlToText(this.msgText);if(e.length&&e.length>this.messageService.maxTextSymbols){this.toastr.warning(`\u0412 \u043F\u043E\u043B\u0435 \u0432\u0432\u043E\u0434\u0430 \u0431\u043E\u043B\u0435\u0435 ${this.messageService.maxTextSymbols} \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432!`);return}let i=this.getFileShortUrls$(this.fileSrcList);this.sending=!0,(i.length?Et(i):at([])).subscribe(r=>{if(!!!(e.length||r.length||this.forwardedMessages.length)){console.log("\u041A\u043E\u043D\u0442\u0435\u043D\u0442 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442!"),this.sending=!1;return}if(!this.messageService.isMessageSendable){this.toastr.warning("\u0418\u043D\u0442\u0435\u0440\u0432\u0430\u043B \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0438 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439 \u043D\u0435 \u043F\u0440\u043E\u0439\u0434\u0435\u043D!"),this.sending=!1;return}if(this.chat){let d={text:e,fileShortUrls:r,forwarded:this.editingMessage?void 0:this.forwardedMessages};this.messageService.sendMessage(this.chat,d,this.editingMessage?.msgId).subscribe(()=>{this.editingMessage?.msgId?console.log("\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435 \u043E\u0442\u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u043E"):console.log("\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u043E"),this.resetChatData()})}})}resetChatData(){this.chat&&(this.cacheService.setMessageTextByChatId(this.chat.id),this.messageService.forwardedMap[this.chat.id]=void 0,this.forwardedMessages=[]),this.editingMessage=void 0,this.sending=!1,this.msgText="",this.fileSrcList=[]}getFileShortUrls$(e){return e.map(i=>typeof i=="string"?at(this.fileService.getShortUrl(i,this.urlCategory)):this.fileService.uploadFileToStorage(i,this.urlCategory).pipe(Tt(200)))}scrollDown(e){setTimeout(()=>this.scrollAnchor?.nativeElement.scrollIntoView({behavior:e,block:"end"}))}};o.\u0275fac=function(i){return new(i||o)(f(ei),f(Re),f(De),f(ue),f(pe),f(me),f(ii),f(qt),f(ze),f(Ai),f(si))},o.\u0275cmp=I({type:o,selectors:[["app-chat"]],viewQuery:function(i,r){if(i&1&&H(xo,5),i&2){let m;q(m=G())&&(r.scrollAnchor=m.first)}},inputs:{chat:"chat"},features:[te],decls:1,vars:1,consts:[["scrollAnchor",""],[1,"chat"],[1,"chat__overlay"],[1,"chat__header"],[1,"chat__body"],[1,"chat__messages","custom-scrollbar"],[1,"chat__controls"],[1,"chat__input",3,"ngModelChange","onFileSrcListSelect","onStickerSelect","onEnterPress","onSubmit","fileSrcList","ngModel"],[1,"chat__attachment"],[3,"click"],[3,"onTextClick","avatar","caption","online","text","minimize"],[1,"chat__message",3,"message","reacts","selected","status"],[1,"font-basic"],[1,"chat__message",3,"onDelete","onEdit","onRender","onReact","onReactGroupedClick","click","message","reacts","selected","status"],[1,"link","font-basic-14"],[1,"link","font-basic-14",3,"click"]],template:function(i,r){i&1&&_(0,Oo,13,6,"div",1),i&2&&v(0,r.chat?0:-1)},dependencies:[ge,_e,We,he,Li,Gt,$t,Ni,Qt],styles:[".chat[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;height:100%}.chat__overlay[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background-color:var(--gray-transparent-30);-webkit-backdrop-filter:blur(1px);backdrop-filter:blur(1px);z-index:1}.chat__header[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;gap:8px;border-bottom:1px solid var(--gray-500);min-height:48px;max-height:48px}.chat__body[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-grow:1;overflow:hidden}.chat__messages[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:12px;flex-grow:1;overflow-y:auto}.chat__message[_ngcontent-%COMP%]{cursor:pointer}.chat__controls[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.chat__input[_ngcontent-%COMP%]{flex-grow:1}.chat__attachment[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;gap:4px}"]});let n=o;return n})();function Ao(n,o){n&1&&x(0,"app-loader")}function Ro(n,o){if(n&1&&(a(0,"h4",0),S(1),c()),n&2){let t=s(2);l(),X(t.errorMsg)}}function Vo(n,o){if(n&1&&x(0,"app-chat",1),n&2){let t=s(2);h("chat",t.chat)}}function Do(n,o){if(n&1&&_(0,Ro,2,1,"h4",0)(1,Vo,1,1),n&2){let t=s();v(0,t.errorMsg?0:1)}}var Hi=(()=>{let o=class o{constructor(e,i){this.activatedRoute=e,this.chatService=i,this.errorMsg="",this.loading=!1,this.activatedRoute.paramMap.subscribe(r=>{if(this.errorMsg="",this.loading=!0,r.get("id")&&!isNaN(Number(r.get("id")))){let m=Number(r.get("id")),d=this.chatService.chatsMap[m];d?this.chat=d:this.errorMsg="\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0447\u0430\u0442\u0430!",this.loading=!1}})}};o.\u0275fac=function(i){return new(i||o)(f(Dt),f(Re))},o.\u0275cmp=I({type:o,selectors:[["app-chat-page"]],decls:2,vars:1,consts:[[1,"font-head"],[3,"chat"]],template:function(i,r){i&1&&_(0,Ao,1,0,"app-loader")(1,Do,2,1),i&2&&v(0,r.loading?0:1)},dependencies:[he,Ui]});let n=o;return n})();var zo=[{path:"",component:Hi}],qi=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({imports:[xe.forChild(zo),xe]});let n=o;return n})();var Je=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({imports:[F,di,Ce]});let n=o;return n})();var Xe=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({imports:[F,Zt,yi]});let n=o;return n})();var et=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({imports:[F,Ne,Ue,Ke]});let n=o;return n})();var tt=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({imports:[F,Ue,Ne,Ke,Ye,Je,Xe,et]});let n=o;return n})();var Gi=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({imports:[F,Ye]});let n=o;return n})();var $i=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({imports:[F,fe,ri,Vi,Gi,Je,Xe]});let n=o;return n})();var Ki=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({imports:[F,tt]});let n=o;return n})();var Qi=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({imports:[F,fe,tt,Ce,xe,$i,Ki,ci,ai,Kt,Bi,Yt,et]});let n=o;return n})();var ka=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=y({type:o}),o.\u0275inj=j({imports:[F,qi,Ce,Qi]});let n=o;return n})();export{ka as ChatPageModule};
