import{a as g,d as v,f as b,g as E,h as I}from"./chunk-TYDQPGPQ.js";import{Gb as l,Ib as o,L as m,Lb as f,Nb as p,O as s,Pb as d,Rb as h,ac as a,pc as S}from"./chunk-BQNWQ6CD.js";var F=(()=>{let r=class r{constructor(e,i,t,n,c){this.auth=e,this.router=i,this.userService=t,this.eventService=n,this.fileService=c}login(e){d(this.auth,e.email,e.password).then(i=>{console.log(i),this.userService.getUserId(i.user.uid).subscribe(t=>{t&&(t===this.userService.userId?(this.userService.userId=t,this.router.navigate([o.HOME])):(console.log(`ID \u044E\u0437\u0435\u0440\u0430 \u043D\u0435 \u0440\u0430\u0432\u0435\u043D \u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0435\u043C\u0443, \u043E\u0447\u0438\u0449\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435 \u0441\u0442\u0430\u0440. \u044E\u0437\u0435\u0440\u0430, ${t}, ${this.userService.userId}`),this.resetUserData(),v.delete(h).then(()=>{this.userService.userId=t,this.router.navigate([o.HOME])})))})})}registration(e){this.resetUserData(),v.delete(h).then(()=>{p(this.auth,e.email,e.password).then(i=>{this.fileService.uploadAvatar(e.avatar).subscribe(t=>{console.log(`avatar: ${t}`),this.userService.addUserId(i.user.uid).subscribe(n=>{console.log(n);let c=this.eventService.addEvent({type:g.REG_USER,recipients:[],forAll:!0,body:{id:n,avatarShortUrl:a(t),name:a(e.name),nick:a(e.nick),bio:a(e.bio)}});n===1?(console.log("\u0421\u0440\u0430\u0437\u0443 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u044F\u0435\u043C \u0441\u043E\u0431\u044B\u0442\u0438\u0435 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0438 \u043F\u043E\u0442\u043E\u043C \u0440\u043E\u0443\u0442\u0438\u043C"),c.subscribe(()=>{this.router.navigate([o.HOME])})):(console.log("\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0440\u043E\u0443\u0442\u0438\u043C, \u0430 \u043F\u043E\u0442\u043E\u043C \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u044F\u0435\u043C \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435 \u043F\u043E\u0441\u043B\u0435 \u043F\u0440\u043E\u0447\u0442\u0435\u043D\u0438\u044F \u0441\u043E\u0431\u044B\u0442\u0438\u0439"),this.router.navigate([o.HOME]),b(this.eventService.eventsReceived$).subscribe(U=>{console.log(U),c.subscribe()}))})})})})}logout(){this.auth.signOut().then(e=>{this.router.navigate([o.LOGIN])})}resetUserData(){this.eventService.lastEventTs=0,this.userService.userId=null,this.userService.currentUser=void 0}};r.\u0275fac=function(i){return new(i||r)(s(f),s(l),s(S),s(E),s(I))},r.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"});let u=r;return u})();export{F as a};
